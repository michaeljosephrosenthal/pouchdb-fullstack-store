{"version":3,"sources":["webpack:///node.js","webpack:///webpack/bootstrap d768b71a8cc454aa2e3f","webpack:///external \"redux\"","webpack:///./src/configureServer.js","webpack:///./src/dataFlows.js","webpack:///./src/domainDrivenPouchPersistencePlugin.js","webpack:///./src/domainMiddlewareGenerator.js","webpack:///./src/index.js","webpack:///./src/reduxMiddleware.js","webpack:///external \"async-function-queue\"","webpack:///external \"deep-equal\"","webpack:///external \"json-path\"","webpack:///external \"pouchdb\"","webpack:///external \"pouchdb-authentication\"","webpack:///external \"requisition\"","webpack:///external \"strictduck-domain-driven-fullstack\""],"names":["require","install","module","exports","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","_interopRequireDefault","obj","__esModule","default","_asyncToGenerator","fn","gen","apply","this","arguments","Promise","resolve","reject","step","key","arg","info","value","error","done","then","err","catchAndTrace","message","console","log","trace","Object","defineProperty","_extends","assign","target","i","length","source","prototype","hasOwnProperty","createSuperAdmin","ref","regeneratorRuntime","mark","_callee","_ref","resp","_resp","uri","name","password","wrap","_context","prev","next","_requisition2","put","send","sent","t0","status","login","abrupt","t1","stop","_x","initUser","_callee2","_ref2","_context2","signup","_x2","initDbUsers","_callee3","_ref3","_ref3$credentials","credentials","admin","users","_context3","forEach","_x3","_requisition","configure","_x4","_callee4","_ref4","_ref4$settings$db","settings","db","_context4","_toConsumableArray","arr","Array","isArray","arr2","from","INSERT","state","payload","concat","UPDATE","map","doc","_id","REMOVE","filter","fullUri","_strictduckDomainDrivenFullstack","_pouchdb","_pouchdb2","_pouchdbAuthentication","_pouchdbAuthentication2","_domainMiddlewareGenerator","_domainMiddlewareGenerator2","plugin","provide","storePersistencePlugin","implement","constructor","Domains","skipSetup","middlewareGenerator","provider","bind","undefined","invert","keys","reduce","inversion","dbActions","_ref$domain","domain","_ref$domain$actions","actions","_ref$domain$pouchActi","pouchActionMap","actionMap","insert","update","remove","invertedActionMap","acts","a","indexOf","dbActs","e","TypeError","domainDrivenReduxMiddleware","domains","_reduxMiddleware2","values","path","prefix","dbPrefix","_reduxMiddleware","defaultDataFlows","_domainDrivenPouchPersistencePlugin","_domainDrivenPouchPersistencePlugin2","_dataFlows","_dataFlows2","_objectWithoutProperties","_classCallCheck","instance","Constructor","warn","what","defaultAction","action","Error","_initFromDb","lifecycleState","allDocs","include_docs","startkey","endkey","result","rows","row","onDbChange","listen","changes","live","since","split","on","change","processNewStateForPath","docsContainer","_jsonPath2","docs","_differences","differences","updated","deleted","inserted","oldDocs","newDocs","oldDocId","newDoc","oldDoc","_deepEqual2","push","changeDoc","_deleted","propagations","reduxMiddleware","paths","options","Path","dispatch","getState","wrapActionCreators","initFromDb","nextAction","_createClass","defineProperties","props","descriptor","enumerable","configurable","writable","protoProps","staticProps","_jsonPath","_asyncFunctionQueue","_asyncFunctionQueue2","_deepEqual","defaultActions","_ref2$path","_ref2$prefix","queue","cb","_this","_this2","act"],"mappings":"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","file":"node.js","sourcesContent":["require(\"source-map-support\").install();\nmodule.exports =\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tmodule.exports = __webpack_require__(6);\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"redux\");\n\n/***/ },\n/* 2 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\t\n\tvar createSuperAdmin = function () {\n\t    var ref = _asyncToGenerator(regeneratorRuntime.mark(function _callee(_ref) {\n\t        var uri = _ref.uri;\n\t        var name = _ref.name;\n\t        var password = _ref.password;\n\t\n\t        var resp, _resp;\n\t\n\t        return regeneratorRuntime.wrap(function _callee$(_context) {\n\t            while (1) {\n\t                switch (_context.prev = _context.next) {\n\t                    case 0:\n\t                        _context.prev = 0;\n\t                        _context.next = 3;\n\t                        return _requisition2.default.put(uri + '/_config/admins/' + name).send('\"' + password + '\"');\n\t\n\t                    case 3:\n\t                        resp = _context.sent;\n\t\n\t                        console.log('Server admin created');\n\t                        _context.next = 10;\n\t                        break;\n\t\n\t                    case 7:\n\t                        _context.prev = 7;\n\t                        _context.t0 = _context['catch'](0);\n\t\n\t                        if (_context.t0.status != 409) {\n\t                            catchAndTrace('error creating superadmin', _context.t0);\n\t                        } else {\n\t                            console.log('Server admin already exists');\n\t                        }\n\t\n\t                    case 10:\n\t                        _context.prev = 10;\n\t                        _context.next = 13;\n\t                        return this.login(name, password);\n\t\n\t                    case 13:\n\t                        _resp = _context.sent;\n\t\n\t                        console.log('Server admin logged in');\n\t                        return _context.abrupt('return', _resp);\n\t\n\t                    case 18:\n\t                        _context.prev = 18;\n\t                        _context.t1 = _context['catch'](10);\n\t\n\t                        catchAndTrace('error logging in superadmin', _context.t1);\n\t\n\t                    case 21:\n\t                    case 'end':\n\t                        return _context.stop();\n\t                }\n\t            }\n\t        }, _callee, this, [[0, 7], [10, 18]]);\n\t    }));\n\t\n\t    return function createSuperAdmin(_x) {\n\t        return ref.apply(this, arguments);\n\t    };\n\t}();\n\t\n\tvar initUser = function () {\n\t    var ref = _asyncToGenerator(regeneratorRuntime.mark(function _callee2(_ref2) {\n\t        var name = _ref2.name;\n\t        var password = _ref2.password;\n\t        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n\t            while (1) {\n\t                switch (_context2.prev = _context2.next) {\n\t                    case 0:\n\t                        _context2.prev = 0;\n\t                        _context2.next = 3;\n\t                        return this.signup(name, password);\n\t\n\t                    case 3:\n\t                        _context2.next = 8;\n\t                        break;\n\t\n\t                    case 5:\n\t                        _context2.prev = 5;\n\t                        _context2.t0 = _context2['catch'](0);\n\t\n\t                        if (_context2.t0.status != 409) {\n\t                            catchAndTrace('error creating superadmin', _context2.t0);\n\t                        } else {\n\t                            console.log('user ' + name + ' already exists');\n\t                        }\n\t\n\t                    case 8:\n\t                    case 'end':\n\t                        return _context2.stop();\n\t                }\n\t            }\n\t        }, _callee2, this, [[0, 5]]);\n\t    }));\n\t\n\t    return function initUser(_x2) {\n\t        return ref.apply(this, arguments);\n\t    };\n\t}();\n\t\n\tvar initDbUsers = function () {\n\t    var ref = _asyncToGenerator(regeneratorRuntime.mark(function _callee3(_ref3) {\n\t        var _ref3$credentials = _ref3.credentials;\n\t        var admin = _ref3$credentials.admin;\n\t        var users = _ref3$credentials.users;\n\t        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n\t            while (1) {\n\t                switch (_context3.prev = _context3.next) {\n\t                    case 0:\n\t                        _context3.prev = 0;\n\t                        _context3.next = 3;\n\t                        return createSuperAdmin(_extends({ uri: uri }, admin));\n\t\n\t                    case 3:\n\t                        _context3.next = 8;\n\t                        break;\n\t\n\t                    case 5:\n\t                        _context3.prev = 5;\n\t                        _context3.t0 = _context3['catch'](0);\n\t\n\t                        catchAndTrace('error in initDbUsers', _context3.t0);\n\t\n\t                    case 8:\n\t                        users.forEach(initUser);\n\t\n\t                    case 9:\n\t                    case 'end':\n\t                        return _context3.stop();\n\t                }\n\t            }\n\t        }, _callee3, this, [[0, 5]]);\n\t    }));\n\t\n\t    return function initDbUsers(_x3) {\n\t        return ref.apply(this, arguments);\n\t    };\n\t}();\n\t\n\tvar _requisition = __webpack_require__(13);\n\t\n\tvar _requisition2 = _interopRequireDefault(_requisition);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { return Promise.resolve(value).then(function (value) { return step(\"next\", value); }, function (err) { return step(\"throw\", err); }); } } return step(\"next\"); }); }; }\n\t\n\tfunction catchAndTrace(message, err) {\n\t    console.log(message, err);\n\t    console.trace(err);\n\t}\n\t\n\texports.default = function () {\n\t    var ref = _asyncToGenerator(regeneratorRuntime.mark(function _callee4(_ref4) {\n\t        var _ref4$settings$db = _ref4.settings.db;\n\t        var uri = _ref4$settings$db.uri;\n\t        var credentials = _ref4$settings$db.credentials;\n\t        return regeneratorRuntime.wrap(function _callee4$(_context4) {\n\t            while (1) {\n\t                switch (_context4.prev = _context4.next) {\n\t                    case 0:\n\t                        if (credentials) initDbUsers({ credentials: credentials });\n\t\n\t                    case 1:\n\t                    case 'end':\n\t                        return _context4.stop();\n\t                }\n\t            }\n\t        }, _callee4, this);\n\t    }));\n\t\n\t    function configure(_x4) {\n\t        return ref.apply(this, arguments);\n\t    }\n\n\t    return configure;\n\t}();\n\n/***/ },\n/* 3 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\t\n\texports.default = {\n\t    INSERT: function INSERT(state, payload) {\n\t        return [payload].concat(_toConsumableArray(state));\n\t    },\n\t    UPDATE: function UPDATE(state, payload) {\n\t        return state.map(function (doc) {\n\t            return doc._id == payload._id ? payload : doc;\n\t        });\n\t    },\n\t    REMOVE: function REMOVE(state, _ref) {\n\t        var _id = _ref._id;\n\t\n\t        return state.filter(function (doc) {\n\t            return doc._id != _id;\n\t        });\n\t    }\n\t};\n\n/***/ },\n/* 4 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _strictduckDomainDrivenFullstack = __webpack_require__(14);\n\t\n\tvar _pouchdb = __webpack_require__(11);\n\t\n\tvar _pouchdb2 = _interopRequireDefault(_pouchdb);\n\t\n\tvar _pouchdbAuthentication = __webpack_require__(12);\n\t\n\tvar _pouchdbAuthentication2 = _interopRequireDefault(_pouchdbAuthentication);\n\t\n\tvar _domainMiddlewareGenerator = __webpack_require__(5);\n\t\n\tvar _domainMiddlewareGenerator2 = _interopRequireDefault(_domainMiddlewareGenerator);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\t_pouchdb2.default.plugin(_pouchdbAuthentication2.default);\n\t\n\tvar provide = ( true ? __webpack_require__(2) : require('./domainMiddlewareGenerator')).default;\n\t\n\tfunction fullUri(_ref) {\n\t    var name = _ref.name;\n\t    var uri = _ref.uri;\n\t\n\t    return uri + '/' + name;\n\t}\n\t\n\texports.default = _strictduckDomainDrivenFullstack.storePersistencePlugin.implement({\n\t    name: 'DomainDrivenPouchPersistencePlugin',\n\t    constructor: function constructor(_ref2) {\n\t        var db = _ref2.Domains.settings.db;\n\t\n\t        return [{\n\t            db: new _pouchdb2.default(fullUri(db), { skipSetup: true }),\n\t            middlewareGenerator: _domainMiddlewareGenerator2.default\n\t        }];\n\t    },\n\t    provider: function provider() {\n\t        return provide.bind(this.db).apply(undefined, arguments);\n\t    }\n\t});\n\n/***/ },\n/* 5 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\texports.default = domainDrivenReduxMiddleware;\n\t\n\tvar _redux = __webpack_require__(1);\n\t\n\tvar _reduxMiddleware = __webpack_require__(7);\n\t\n\tvar _reduxMiddleware2 = _interopRequireDefault(_reduxMiddleware);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction invert(obj) {\n\t    return Object.keys(obj).reduce(function (inversion, key) {\n\t        inversion[obj[key]] = key;\n\t        return inversion;\n\t    }, {});\n\t}\n\t\n\tfunction dbActions(_ref) {\n\t    var _ref$domain = _ref.domain;\n\t    var _ref$domain$actions = _ref$domain.actions;\n\t    var actions = _ref$domain$actions === undefined ? {} : _ref$domain$actions;\n\t    var _ref$domain$pouchActi = _ref$domain.pouchActionMap;\n\t    var actionMap = _ref$domain$pouchActi === undefined ? { insert: 'insert', update: 'update', remove: 'remove' } : _ref$domain$pouchActi;\n\t\n\t    var invertedActionMap = invert(actionMap);\n\t    var acts = Object.keys(actions).filter(function (a) {\n\t        return [actionMap.update, actionMap.insert, actionMap.remove].indexOf(a) >= 0;\n\t    }).reduce(function (dbActs, a) {\n\t        dbActs[invertedActionMap[a]] = function (doc) {\n\t            try {\n\t                return actions[a](doc);\n\t            } catch (e) {\n\t                if (e instanceof TypeError) {\n\t                    return;\n\t                } else {\n\t                    throw e;\n\t                }\n\t            }\n\t        };\n\t        return dbActs;\n\t    }, {});\n\t    return Object.keys(acts).length ? acts : false;\n\t}\n\t\n\tfunction domainDrivenReduxMiddleware(_ref2) {\n\t    var db = _ref2.db;\n\t    var domains = _ref2.domains;\n\t\n\t    return (0, _reduxMiddleware2.default)(Object.values(domains).filter(function (domain) {\n\t        return dbActions({ domain: domain });\n\t    }).map(function (domain) {\n\t        return domain;\n\t    }).map(function (domain) {\n\t        return {\n\t            path: '/' + domain.prefix,\n\t            prefix: '' + (domain.dbPrefix || ''),\n\t            db: db,\n\t            actions: dbActions({ domain: domain })\n\t        };\n\t    }));\n\t}\n\n/***/ },\n/* 6 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.defaultDataFlows = exports.default = undefined;\n\t\n\tvar _domainDrivenPouchPersistencePlugin = __webpack_require__(4);\n\t\n\tvar _domainDrivenPouchPersistencePlugin2 = _interopRequireDefault(_domainDrivenPouchPersistencePlugin);\n\t\n\tvar _dataFlows = __webpack_require__(3);\n\t\n\tvar _dataFlows2 = _interopRequireDefault(_dataFlows);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\texports.default = _domainDrivenPouchPersistencePlugin2.default;\n\texports.defaultDataFlows = _dataFlows2.default;\n\n/***/ },\n/* 7 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\t\n\texports.default = reduxMiddleware;\n\t\n\tvar _jsonPath = __webpack_require__(10);\n\t\n\tvar _jsonPath2 = _interopRequireDefault(_jsonPath);\n\t\n\tvar _asyncFunctionQueue = __webpack_require__(8);\n\t\n\tvar _asyncFunctionQueue2 = _interopRequireDefault(_asyncFunctionQueue);\n\t\n\tvar _deepEqual = __webpack_require__(9);\n\t\n\tvar _deepEqual2 = _interopRequireDefault(_deepEqual);\n\t\n\tvar _redux = __webpack_require__(1);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _objectWithoutProperties(obj, keys) { var target = {}; for (var i in obj) { if (keys.indexOf(i) >= 0) continue; if (!Object.prototype.hasOwnProperty.call(obj, i)) continue; target[i] = obj[i]; } return target; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction warn(what) {\n\t    var fn = console.warn || console.log;\n\t    if (fn) {\n\t        fn.call(console, what);\n\t    }\n\t}\n\t\n\tfunction defaultAction(action) {\n\t    return function () {\n\t        throw new Error('no action provided for ' + action);\n\t    };\n\t}\n\t\n\tvar defaultActions = {\n\t    remove: defaultAction('remove'),\n\t    update: defaultAction('update'),\n\t    insert: defaultAction('insert')\n\t};\n\t\n\tfunction _initFromDb(path) {\n\t    if (!path.lifecycleState) {\n\t        path.lifecycleState = 'INITIALIZING';\n\t        path.db.allDocs(_extends({\n\t            include_docs: true\n\t        }, path.prefix ? {\n\t            startkey: path.prefix,\n\t            endkey: path.prefix + '￿'\n\t        } : {})).then(function (result) {\n\t            result.rows.forEach(function (row) {\n\t                return onDbChange(path, row);\n\t            });\n\t            path.lifecycleState = 'INITIALIZED';\n\t            listen(path);\n\t        }).catch(function (err) {\n\t            return console.log(err);\n\t        });\n\t    }\n\t}\n\t\n\tfunction listen(path) {\n\t    var changes = path.db.changes(_extends({\n\t        live: true, since: 'now', include_docs: true\n\t    }, path.prefix ? {\n\t        filter: function filter(_ref) {\n\t            var _id = _ref._id;\n\t            return _id.split('/')[0] == path.prefix;\n\t        }\n\t    } : {}));\n\t    changes.on('change', function (change) {\n\t        return onDbChange(path, change);\n\t    });\n\t}\n\t\n\tfunction processNewStateForPath(path, state) {\n\t    var docsContainer = _jsonPath2.default.resolve(state, path.path);\n\t\n\t    /* istanbul ignore else */\n\t    if (docsContainer && docsContainer.length && path.lifecycleState == 'INITIALIZED') {\n\t        docsContainer.forEach(function (docs) {\n\t            var _differences = differences(path.docs, docs);\n\t\n\t            var updated = _differences.updated;\n\t            var deleted = _differences.deleted;\n\t            var inserted = _differences.inserted;\n\t\n\t            inserted.concat(updated).forEach(function (doc) {\n\t                return path.insert(doc);\n\t            });\n\t            deleted.forEach(function (doc) {\n\t                return path.remove(doc);\n\t            });\n\t        });\n\t    }\n\t}\n\t\n\tvar Path = function () {\n\t    function Path(_ref2) {\n\t        var _ref2$path = _ref2.path;\n\t        var path = _ref2$path === undefined ? '.' : _ref2$path;\n\t        var _ref2$prefix = _ref2.prefix;\n\t        var prefix = _ref2$prefix === undefined ? '' : _ref2$prefix;\n\t        var db = _ref2.db;\n\t        var actions = _ref2.actions;\n\t\n\t        _classCallCheck(this, Path);\n\t\n\t        if (!db) {\n\t            throw new Error('path ' + path.path + ' needs a db');\n\t        }\n\t\n\t        this.queue = (0, _asyncFunctionQueue2.default)(1);\n\t        this.docs = {};\n\t\n\t        this.db = db;\n\t        this.path = path;\n\t        this.prefix = prefix;\n\t        this.actions = Object.assign({}, defaultActions, actions);\n\t    }\n\t\n\t    _createClass(Path, [{\n\t        key: 'insert',\n\t        value: function insert(doc) {\n\t            this.docs[doc._id] = doc;\n\t            var db = this.db;\n\t            this.queue.push(function (cb) {\n\t                db.put(doc, cb);\n\t            });\n\t        }\n\t    }, {\n\t        key: 'remove',\n\t        value: function remove(doc) {\n\t            var _this = this;\n\t\n\t            var db = this.db;\n\t            this.queue.push(function (cb) {\n\t                db.remove(doc, cb);\n\t                delete _this.docs[doc._id];\n\t            });\n\t        }\n\t    }, {\n\t        key: 'wrapActionCreators',\n\t        value: function wrapActionCreators(dispatch) {\n\t            var _this2 = this;\n\t\n\t            this.propagations = Object.keys(this.actions).reduce(function (propagations, act) {\n\t                propagations[act] = function (doc) {\n\t                    var action = _this2.actions[act](doc);\n\t                    if (action) dispatch(action);\n\t                };\n\t                return propagations;\n\t            }, {});\n\t        }\n\t    }, {\n\t        key: 'initFromDb',\n\t        value: function initFromDb() {\n\t            _initFromDb(this);\n\t        }\n\t    }]);\n\t\n\t    return Path;\n\t}();\n\t\n\tfunction differences(oldDocs, newDocs) {\n\t    var inserted = [],\n\t        updated = [],\n\t        deleted = Object.keys(oldDocs).map(function (oldDocId) {\n\t        return oldDocs[oldDocId];\n\t    });\n\t\n\t    newDocs.forEach(function (newDoc) {\n\t        if (!newDoc._id) warn('doc with no id');\n\t\n\t        deleted = deleted.filter(function (doc) {\n\t            return doc._id !== newDoc._id;\n\t        });\n\t\n\t        var oldDoc = oldDocs[newDoc._id];\n\t        if (!oldDoc) {\n\t            inserted.push(newDoc);\n\t        } else if (!(0, _deepEqual2.default)(oldDoc, newDoc)) {\n\t            updated.push(newDoc);\n\t        }\n\t    });\n\t    return { inserted: inserted, updated: updated, deleted: deleted };\n\t}\n\t\n\tfunction onDbChange(path, _ref3) {\n\t    var changeDoc = _ref3.doc;\n\t\n\t    var change = _objectWithoutProperties(_ref3, ['doc']);\n\t\n\t    if (changeDoc._deleted) {\n\t        if (path.docs[changeDoc._id]) {\n\t            delete path.docs[changeDoc._id];\n\t            path.propagations.remove(changeDoc);\n\t        }\n\t    } else {\n\t        var oldDoc = path.docs[changeDoc._id];\n\t        path.docs[changeDoc._id] = changeDoc;\n\t        if (oldDoc) {\n\t            path.propagations.update(changeDoc);\n\t        } else {\n\t            path.propagations.insert(changeDoc);\n\t        }\n\t    }\n\t}\n\t\n\tfunction reduxMiddleware() {\n\t    var paths = arguments.length <= 0 || arguments[0] === undefined ? [] : arguments[0];\n\t\n\t    if (!Array.isArray(paths)) paths = [paths];\n\t\n\t    if (!paths.length) throw new Error('PouchMiddleware: no paths');\n\t\n\t    paths = paths.map(function (options) {\n\t        return new Path(options);\n\t    });\n\t\n\t    return function (_ref4) {\n\t        var dispatch = _ref4.dispatch;\n\t        var getState = _ref4.getState;\n\t\n\t        paths.forEach(function (path) {\n\t            path.wrapActionCreators(dispatch);\n\t            path.initFromDb();\n\t        });\n\t        return function (next) {\n\t            return function (action) {\n\t                var nextAction = next(action);\n\t                paths.forEach(function (path) {\n\t                    return processNewStateForPath(path, getState());\n\t                });\n\t                return nextAction;\n\t            };\n\t        };\n\t    };\n\t}\n\n/***/ },\n/* 8 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"async-function-queue\");\n\n/***/ },\n/* 9 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"deep-equal\");\n\n/***/ },\n/* 10 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"json-path\");\n\n/***/ },\n/* 11 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"pouchdb\");\n\n/***/ },\n/* 12 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"pouchdb-authentication\");\n\n/***/ },\n/* 13 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"requisition\");\n\n/***/ },\n/* 14 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"strictduck-domain-driven-fullstack\");\n\n/***/ }\n/******/ ]);\n\n\n/** WEBPACK FOOTER **\n ** node.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap d768b71a8cc454aa2e3f\n **/","module.exports = require(\"redux\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"redux\"\n ** module id = 1\n ** module chunks = 0\n **/","import req from 'requisition'\n\nfunction catchAndTrace(message, err){\n    console.log(message, err)\n    console.trace(err)\n}\n\nasync function createSuperAdmin({ uri, name, password }){\n    try {\n        let resp = await req\n            .put(`${uri}/_config/admins/${name}`)\n            .send(`\"${password}\"`)\n        console.log('Server admin created')\n    } catch (err) {\n        if(err.status != 409){\n            catchAndTrace('error creating superadmin', err)\n        } else {\n            console.log('Server admin already exists')\n        }\n    }\n\n    try {\n        let resp = await this.login(name, password)\n        console.log('Server admin logged in')\n        return resp\n    } catch (err) {\n        catchAndTrace('error logging in superadmin', err)\n    }\n}\n\nasync function initUser({name, password}){\n    try {\n        await this.signup(name, password)\n    } catch (err) {\n        if(err.status != 409){\n            catchAndTrace('error creating superadmin', err)\n        } else {\n            console.log(`user ${name} already exists`)\n        }\n    }\n}\n\nasync function initDbUsers({\n    credentials: {admin, users}\n}){\n    try {\n        await createSuperAdmin({ uri, ...admin })\n    } catch (err) {\n        catchAndTrace('error in initDbUsers', err)\n    }\n    users.forEach(initUser)\n}\n\nexport default async function configure({\n    settings: { db: {uri, credentials} }\n}){\n    if(credentials)\n        initDbUsers({credentials});\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/configureServer.js\n **/","export default {\n    INSERT(state, payload){\n        return [payload, ...state]\n    },\n    UPDATE(state, payload){\n        return state.map(doc => doc._id == payload._id ? payload : doc)\n    },\n    REMOVE(state, {_id}){\n        return state.filter(doc => doc._id != _id)\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/dataFlows.js\n **/","import { storePersistencePlugin } from 'strictduck-domain-driven-fullstack'\n\nimport PouchDB from 'pouchdb'\nimport PouchDbAuthentication from 'pouchdb-authentication'\n\nPouchDB.plugin(PouchDbAuthentication)\n\nimport domainMiddlewareGenerator from './domainMiddlewareGenerator'\n\nconst provide = ($ES.CONTEXT == 'NODE' ? require('./configureServer') : require('./domainMiddlewareGenerator')).default\n\nfunction fullUri({name, uri}){\n    return `${uri}/${name}`\n}\n\nexport default storePersistencePlugin.implement({\n    name: 'DomainDrivenPouchPersistencePlugin',\n    constructor({ Domains: { settings: { db } } }){\n        return [{\n            db: new PouchDB(fullUri(db), {skipSetup: true}),\n            middlewareGenerator: domainMiddlewareGenerator\n        }]\n    },\n    provider(...args){\n        return provide.bind(this.db)(...args)\n    }\n})\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/domainDrivenPouchPersistencePlugin.js\n **/","import { bindActionCreators } from 'redux'\nimport reduxMiddleware from './reduxMiddleware'\n\nfunction invert(obj){\n    return Object.keys(obj).reduce(\n        (inversion, key) => {\n            inversion[obj[key]] = key\n            return inversion\n        }\n    ,{})\n}\n\nfunction dbActions({domain: {actions = {}, pouchActionMap: actionMap={insert: 'insert', update: 'update', remove: 'remove'} }}){\n    let invertedActionMap = invert(actionMap) \n    let acts = Object.keys(actions)\n        .filter(a => [actionMap.update, actionMap.insert, actionMap.remove].indexOf(a) >= 0 )\n        .reduce((dbActs, a) => {\n            dbActs[invertedActionMap[a]] = doc => {\n                try {\n                    return actions[a](doc)\n                } catch(e) {\n                    if(e instanceof TypeError){\n                        return\n                    } else {\n                        throw e\n                    }\n                }\n            }\n            return dbActs\n        }, {})\n    return Object.keys(acts).length ? acts : false\n}\n\nexport default function domainDrivenReduxMiddleware({db, domains}){\n    return reduxMiddleware(\n        Object.values(domains)\n            .filter(domain => dbActions({ domain }))\n            .map(domain => domain)\n            .map( domain => ({\n                path: `/${domain.prefix}`,\n                prefix: `${domain.dbPrefix || ''}`,\n                db,\n                actions: dbActions({ domain })\n            }))\n    )\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/domainMiddlewareGenerator.js\n **/","export default from './domainDrivenPouchPersistencePlugin'\nexport defaultDataFlows from './dataFlows'\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/index.js\n **/","import jPath from 'json-path'\nimport Queue from 'async-function-queue'\nimport equal from 'deep-equal'\nimport { bindActionCreators } from 'redux'\n\nfunction warn(what) {\n    var fn = console.warn || console.log;\n    if (fn) {\n        fn.call(console, what);\n    }\n}\n\nfunction defaultAction(action) {\n    return function() {\n        throw new Error('no action provided for ' + action);\n    };\n}\n\nconst defaultActions = {\n    remove: defaultAction('remove'),\n    update: defaultAction('update'),\n    insert: defaultAction('insert')\n}\n\n\nfunction initFromDb(path) {\n    if(!path.lifecycleState){\n        path.lifecycleState = 'INITIALIZING'\n        path.db.allDocs({\n            include_docs: true,\n            ...(path.prefix ? {\n                startkey: path.prefix,\n                endkey: `${path.prefix}\\uffff`\n            } : {})\n        }).then(result => {\n            result.rows.forEach(row => onDbChange(path, row))\n            path.lifecycleState = 'INITIALIZED'\n            listen(path)\n        }).catch(err => console.log(err))\n    }\n}\n\nfunction listen(path) {\n    var changes = path.db.changes({\n        live: true, since: 'now', include_docs: true,\n        ...(path.prefix ? {\n            filter: ({_id}) => _id.split('/')[0] == path.prefix\n            } : {})\n    });\n    changes.on('change', change => onDbChange(path, change));\n}\n\n\nfunction processNewStateForPath(path, state) {\n    var docsContainer = jPath.resolve(state, path.path);\n\n    /* istanbul ignore else */\n    if (docsContainer && docsContainer.length && path.lifecycleState == 'INITIALIZED' ){\n        docsContainer.forEach(docs => {\n            var {updated, deleted, inserted} = differences(path.docs, docs)\n            inserted.concat(updated).forEach(doc => path.insert(doc))\n            deleted.forEach(doc => path.remove(doc))\n        });\n    }\n}\n\nclass Path {\n  constructor({path = '.', prefix = '', db, actions}) {\n      if (! db) {\n          throw new Error('path ' + path.path + ' needs a db');\n      }\n\n      this.queue = Queue(1)\n      this.docs = {}\n\n      this.db = db\n      this.path = path\n      this.prefix = prefix\n      this.actions = Object.assign({}, defaultActions, actions)\n  }\n\n  insert(doc) {\n      this.docs[doc._id] = doc\n      var db = this.db\n      this.queue.push(cb => {\n          db.put(doc, cb)\n      })\n  }\n\n  remove(doc) {\n      var db = this.db\n      this.queue.push(cb => {\n          db.remove(doc, cb)\n          delete this.docs[doc._id]\n      })\n  }\n\n  wrapActionCreators(dispatch){\n      this.propagations = Object.keys(this.actions).reduce(\n          (propagations, act) => {\n              propagations[act] = doc => {\n                  let action = this.actions[act](doc)\n                  if(action) dispatch(action)\n              }\n              return propagations\n          }, {}\n      )\n  }\n\n  initFromDb(){ initFromDb(this) }\n  \n}\n\nfunction differences(oldDocs, newDocs) {\n    var inserted = [],\n        updated = [],\n        deleted = Object.keys(oldDocs).map(oldDocId => oldDocs[oldDocId]);\n\n    newDocs.forEach(newDoc => {\n        if (! newDoc._id) warn('doc with no id');\n\n        deleted = deleted.filter(doc => doc._id !== newDoc._id);\n\n        var oldDoc = oldDocs[newDoc._id];\n        if (! oldDoc) {\n            inserted.push(newDoc);\n        } else if (!equal(oldDoc, newDoc)) {\n            updated.push(newDoc);\n        }\n    });\n    return {inserted, updated, deleted}\n}\n\nfunction onDbChange(path, {doc: changeDoc, ...change}) {\n    if (changeDoc._deleted) {\n        if (path.docs[changeDoc._id]) {\n            delete path.docs[changeDoc._id];\n            path.propagations.remove(changeDoc);\n        }\n    } else {\n        var oldDoc = path.docs[changeDoc._id];\n        path.docs[changeDoc._id] = changeDoc;\n        if (oldDoc) {\n            path.propagations.update(changeDoc);\n        } else {\n            path.propagations.insert(changeDoc);\n        }\n    }\n}\n\nexport default function reduxMiddleware(paths = []) {\n    if (!Array.isArray(paths)) \n        paths = [paths];\n\n    if (!paths.length)\n        throw new Error('PouchMiddleware: no paths');\n\n    paths = paths.map(options => new Path(options))\n\n\n    return ({dispatch, getState}) => {\n        paths.forEach(path => {\n            path.wrapActionCreators(dispatch)\n            path.initFromDb()\n        })\n        return next => action => {\n            let nextAction = next(action)\n            paths.forEach(path => processNewStateForPath(path, getState()))\n            return nextAction\n        }\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/reduxMiddleware.js\n **/","module.exports = require(\"async-function-queue\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"async-function-queue\"\n ** module id = 8\n ** module chunks = 0\n **/","module.exports = require(\"deep-equal\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"deep-equal\"\n ** module id = 9\n ** module chunks = 0\n **/","module.exports = require(\"json-path\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"json-path\"\n ** module id = 10\n ** module chunks = 0\n **/","module.exports = require(\"pouchdb\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"pouchdb\"\n ** module id = 11\n ** module chunks = 0\n **/","module.exports = require(\"pouchdb-authentication\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"pouchdb-authentication\"\n ** module id = 12\n ** module chunks = 0\n **/","module.exports = require(\"requisition\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"requisition\"\n ** module id = 13\n ** module chunks = 0\n **/","module.exports = require(\"strictduck-domain-driven-fullstack\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"strictduck-domain-driven-fullstack\"\n ** module id = 14\n ** module chunks = 0\n **/"],"sourceRoot":""}