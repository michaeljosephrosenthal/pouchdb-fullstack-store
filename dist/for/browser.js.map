{"version":3,"sources":["webpack:///browser.js","webpack:///webpack/bootstrap 2d949a9d6f1ac3fde22c","webpack:///./src/domainMiddlewareGenerator.js","webpack:///./src/utils.js","webpack:///external \"redux\"","webpack:///./src/dataFlows.js","webpack:///./src/db.js","webpack:///./src/domainDrivenPouchPersistencePlugin.js","webpack:///./src/index.js","webpack:///./src/reduxMiddleware.js","webpack:///external \"async-function-queue\"","webpack:///external \"deep-equal\"","webpack:///external \"json-path\"","webpack:///external \"pouchdb\"","webpack:///external \"pouchdb-authentication\"","webpack:///external \"react\"","webpack:///external \"strictduck-domain-driven-fullstack\""],"names":["require","install","module","exports","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","_interopRequireDefault","obj","__esModule","default","invert","Object","keys","reduce","inversion","key","dbActions","_ref","_ref$domain","domain","_ref$domain$actions","actions","undefined","_ref$domain$pouchActi","pouchActionMap","actionMap","insert","update","remove","invertedActionMap","acts","filter","a","indexOf","dbActs","doc","e","TypeError","length","domainDrivenReduxMiddleware","_ref2","db","domains","_reduxMiddleware2","values","map","path","prefix","dbPrefix","defineProperty","value","_reduxMiddleware","requireAuthWithPersister","persister","nextState","replace","callback","redirect","_","nextPathname","location","pathname","this","getSession","err","response","console","log","userCtx","name","requireAuthFromRoute","requiresAuthentication","provideAuthFromRoute","component","placeholder","assign","providesAuthentication","authenticateRouteBasedOnOnEnter","route","props","onEnter","authenticateFromRouteBasedOnComponent","_ref3","_react2","createElement","_extends","auth","authenticateRoutes","cloneElement","children","provideInjection","dependentFunction","_this","_len","arguments","args","Array","_key","apply","concat","provideInjectionToHandlers","handlers","handler","requiresPersister","expandPersisterBackedDomain","routes","get","register","provideInjectionForDomainRouteHandlers","newDomains","k","requireInjection","defaultDataFlows","target","i","source","prototype","hasOwnProperty","_react","_dataFlows","_dataFlows2","_toConsumableArray","arr","isArray","arr2","from","INSERT","state","payload","UPDATE","_id","REMOVE","fullUri","uri","settings","_pouchdb2","skipSetup","_pouchdb","_pouchdbAuthentication","_pouchdbAuthentication2","plugin","_strictduckDomainDrivenFullstack","_domainMiddlewareGenerator","_domainMiddlewareGenerator2","_db","_db2","_utils","provide","putDb","storePersistencePlugin","implement","constructor","Domains","middlewareGenerator","provider","bind","utils","forEach","enumerable","_domainDrivenPouchPersistencePlugin","_domainDrivenPouchPersistencePlugin2","_objectWithoutProperties","_classCallCheck","instance","Constructor","warn","what","fn","defaultAction","action","Error","_initFromDb","lifecycleState","allDocs","include_docs","startkey","endkey","then","result","rows","row","onDbChange","listen","changes","live","since","split","on","change","processNewStateForPath","docsContainer","_jsonPath2","resolve","docs","_differences","differences","updated","deleted","inserted","oldDocs","newDocs","oldDocId","newDoc","oldDoc","_deepEqual2","push","changeDoc","_deleted","propagations","reduxMiddleware","paths","options","Path","_ref4","dispatch","getState","wrapActionCreators","initFromDb","next","nextAction","_createClass","defineProperties","descriptor","configurable","writable","protoProps","staticProps","_jsonPath","_asyncFunctionQueue","_asyncFunctionQueue2","_deepEqual","defaultActions","_ref2$path","_ref2$prefix","queue","cb","put","_this2","act"],"mappings":"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","file":"browser.js","sourcesContent":["require(\"source-map-support\").install();\nmodule.exports =\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tmodule.exports = __webpack_require__(7);\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\texports.default = domainDrivenReduxMiddleware;\n\t\n\tvar _redux = __webpack_require__(3);\n\t\n\tvar _reduxMiddleware = __webpack_require__(8);\n\t\n\tvar _reduxMiddleware2 = _interopRequireDefault(_reduxMiddleware);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction invert(obj) {\n\t    return Object.keys(obj).reduce(function (inversion, key) {\n\t        inversion[obj[key]] = key;\n\t        return inversion;\n\t    }, {});\n\t}\n\t\n\tfunction dbActions(_ref) {\n\t    var _ref$domain = _ref.domain;\n\t    var _ref$domain$actions = _ref$domain.actions;\n\t    var actions = _ref$domain$actions === undefined ? {} : _ref$domain$actions;\n\t    var _ref$domain$pouchActi = _ref$domain.pouchActionMap;\n\t    var actionMap = _ref$domain$pouchActi === undefined ? { insert: 'insert', update: 'update', remove: 'remove' } : _ref$domain$pouchActi;\n\t\n\t    var invertedActionMap = invert(actionMap);\n\t    var acts = Object.keys(actions).filter(function (a) {\n\t        return [actionMap.update, actionMap.insert, actionMap.remove].indexOf(a) >= 0;\n\t    }).reduce(function (dbActs, a) {\n\t        dbActs[invertedActionMap[a]] = function (doc) {\n\t            try {\n\t                return actions[a](doc);\n\t            } catch (e) {\n\t                if (e instanceof TypeError) {\n\t                    return;\n\t                } else {\n\t                    throw e;\n\t                }\n\t            }\n\t        };\n\t        return dbActs;\n\t    }, {});\n\t    return Object.keys(acts).length ? acts : false;\n\t}\n\t\n\tfunction domainDrivenReduxMiddleware(_ref2) {\n\t    var db = _ref2.db;\n\t    var domains = _ref2.domains;\n\t\n\t    return (0, _reduxMiddleware2.default)(Object.values(domains).filter(function (domain) {\n\t        return dbActions({ domain: domain });\n\t    }).map(function (domain) {\n\t        return domain;\n\t    }).map(function (domain) {\n\t        return {\n\t            path: '/' + domain.prefix,\n\t            prefix: '' + (domain.dbPrefix || ''),\n\t            db: db,\n\t            actions: dbActions({ domain: domain })\n\t        };\n\t    }));\n\t}\n\n/***/ },\n/* 2 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\texports.defaultDataFlows = undefined;\n\t\n\tvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\t\n\texports.requireAuthWithPersister = requireAuthWithPersister;\n\texports.requireAuthFromRoute = requireAuthFromRoute;\n\texports.provideAuthFromRoute = provideAuthFromRoute;\n\texports.authenticateRoutes = authenticateRoutes;\n\texports.provideInjectionForDomainRouteHandlers = provideInjectionForDomainRouteHandlers;\n\texports.requireInjection = requireInjection;\n\t\n\tvar _react = __webpack_require__(14);\n\t\n\tvar _react2 = _interopRequireDefault(_react);\n\t\n\tvar _dataFlows = __webpack_require__(4);\n\t\n\tvar _dataFlows2 = _interopRequireDefault(_dataFlows);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\texports.defaultDataFlows = _dataFlows2.default;\n\tfunction requireAuthWithPersister(_ref) {\n\t    var path = _ref.path;\n\t    var persister = _ref.persister;\n\t\n\t    return function requireAuth(nextState, replace, callback) {\n\t        var redirect = function redirect(_) {\n\t            replace({ nextPathname: nextState.location.pathname }, path);\n\t            callback();\n\t        };\n\t        (persister || this.db).getSession(function (err, response) {\n\t            if (err) {\n\t                console.log(err);\n\t                redirect();\n\t            } else if (!response.userCtx.name) {\n\t                redirect();\n\t            } else {\n\t                callback();\n\t            }\n\t        });\n\t    };\n\t}\n\t\n\tfunction requireAuthFromRoute(path) {\n\t    return {\n\t        requiresAuthentication: true,\n\t        path: path\n\t    };\n\t}\n\t\n\tfunction provideAuthFromRoute(component) {\n\t    var placeholder = function placeholder(_) {\n\t        return _;\n\t    };\n\t    Object.assign(placeholder, {\n\t        providesAuthentication: true,\n\t        component: component\n\t    });\n\t    return placeholder;\n\t}\n\t\n\tfunction authenticateRouteBasedOnOnEnter(_ref2) {\n\t    var route = _ref2.route;\n\t    var persister = _ref2.persister;\n\t\n\t    return route.props.onEnter && route.props.onEnter.requiresAuthentication ? {\n\t        onEnter: requireAuthWithPersister({ path: route.props.onEnter.path, persister: persister })\n\t    } : {};\n\t}\n\t\n\tfunction authenticateFromRouteBasedOnComponent(_ref3) {\n\t    var route = _ref3.route;\n\t    var persister = _ref3.persister;\n\t\n\t    return route.props.component && route.props.component.providesAuthentication ? {\n\t        component: function component(props) {\n\t            return _react2.default.createElement(route.props.component.component, _extends({ auth: persister }, props));\n\t        }\n\t    } : {};\n\t}\n\t\n\tfunction authenticateRoutes(route, persister) {\n\t    persister = persister || this.db;\n\t    return _react2.default.cloneElement(route, _extends({}, authenticateRouteBasedOnOnEnter({ route: route, persister: persister }), authenticateFromRouteBasedOnComponent({ route: route, persister: persister }), {\n\t        key: route.props.path\n\t    }), route.props.children ? route.props.children.map(function (route) {\n\t        return authenticateRoutes(route, persister);\n\t    }) : undefined);\n\t}\n\t\n\tfunction provideInjection(dependentFunction, persister) {\n\t    var _this = this;\n\t\n\t    return function () {\n\t        for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n\t            args[_key] = arguments[_key];\n\t        }\n\t\n\t        return dependentFunction.apply(undefined, [persister || _this.db].concat(args));\n\t    };\n\t}\n\t\n\tfunction provideInjectionToHandlers(route, persister) {\n\t    console.log(route);\n\t    route.handlers = route.handlers.map(function (handler) {\n\t        return handler.requiresPersister ? provideInjection(handler.dependentFunction, persister) : handler;\n\t    });\n\t    return route;\n\t}\n\t\n\tfunction expandPersisterBackedDomain(domain, persister) {\n\t    var routes = domain.get('routes');\n\t    Object.keys(domain.get('routes')).map(function (route) {\n\t        return domain.register('routes', route, provideInjectionToHandlers(routes[route], persister));\n\t    });\n\t    return domain;\n\t}\n\t\n\tfunction provideInjectionForDomainRouteHandlers(domains, persister) {\n\t    persister = persister || this.db;\n\t    return Object.keys(domains).reduce(function (newDomains, k) {\n\t        newDomains[k] = expandPersisterBackedDomain(domains[k], persister);\n\t        return newDomains;\n\t    }, {});\n\t}\n\t\n\tfunction requireInjection(dependentFunction) {\n\t    return {\n\t        requiresPersister: true,\n\t        dependentFunction: dependentFunction\n\t    };\n\t}\n\n/***/ },\n/* 3 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"redux\");\n\n/***/ },\n/* 4 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\t\n\texports.default = {\n\t    INSERT: function INSERT(state, payload) {\n\t        return [payload].concat(_toConsumableArray(state));\n\t    },\n\t    UPDATE: function UPDATE(state, payload) {\n\t        return state.map(function (doc) {\n\t            return doc._id == payload._id ? payload : doc;\n\t        });\n\t    },\n\t    REMOVE: function REMOVE(state, _ref) {\n\t        var _id = _ref._id;\n\t\n\t        return state.filter(function (doc) {\n\t            return doc._id != _id;\n\t        });\n\t    }\n\t};\n\n/***/ },\n/* 5 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t   value: true\n\t});\n\texports.default = db;\n\t\n\tvar _pouchdb = __webpack_require__(12);\n\t\n\tvar _pouchdb2 = _interopRequireDefault(_pouchdb);\n\t\n\tvar _pouchdbAuthentication = __webpack_require__(13);\n\t\n\tvar _pouchdbAuthentication2 = _interopRequireDefault(_pouchdbAuthentication);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\t_pouchdb2.default.plugin(_pouchdbAuthentication2.default);\n\t\n\tfunction fullUri(_ref) {\n\t   var name = _ref.name;\n\t   var uri = _ref.uri;\n\t\n\t   return uri + '/' + name;\n\t}\n\t\n\tfunction db(settings) {\n\t   return new _pouchdb2.default(fullUri(settings), { skipSetup: true });\n\t}\n\n/***/ },\n/* 6 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _strictduckDomainDrivenFullstack = __webpack_require__(15);\n\t\n\tvar _domainMiddlewareGenerator = __webpack_require__(1);\n\t\n\tvar _domainMiddlewareGenerator2 = _interopRequireDefault(_domainMiddlewareGenerator);\n\t\n\tvar _db = __webpack_require__(5);\n\t\n\tvar _db2 = _interopRequireDefault(_db);\n\t\n\tvar _utils = __webpack_require__(2);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tvar provide = ( false ? require('./configureServer') : __webpack_require__(1)).default;\n\tvar putDb =  false ? require('./configureServer').ensureRemoteExistence : function (_) {\n\t    return _;\n\t};\n\t\n\texports.default = _strictduckDomainDrivenFullstack.storePersistencePlugin.implement({\n\t    name: 'DomainDrivenPouchPersistencePlugin',\n\t    constructor: function constructor(_ref) {\n\t        var db = _ref.Domains.settings.db;\n\t\n\t        putDb(db);\n\t        return [{\n\t            db: (0, _db2.default)(db),\n\t            middlewareGenerator: _domainMiddlewareGenerator2.default,\n\t            authenticateRoutes: _utils.authenticateRoutes,\n\t            provideAuthFromRoute: _utils.provideAuthFromRoute,\n\t            provideInjectionForDomainRouteHandlers: _utils.provideInjectionForDomainRouteHandlers\n\t        }];\n\t    },\n\t    provider: function provider() {\n\t        return provide.bind(this.db).apply(undefined, arguments);\n\t    }\n\t});\n\n/***/ },\n/* 7 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.utils = exports.default = undefined;\n\t\n\tvar _utils = __webpack_require__(2);\n\t\n\tObject.keys(_utils).forEach(function (key) {\n\t  if (key === \"default\") return;\n\t  Object.defineProperty(exports, key, {\n\t    enumerable: true,\n\t    get: function get() {\n\t      return _utils[key];\n\t    }\n\t  });\n\t});\n\t\n\tvar _domainDrivenPouchPersistencePlugin = __webpack_require__(6);\n\t\n\tvar _domainDrivenPouchPersistencePlugin2 = _interopRequireDefault(_domainDrivenPouchPersistencePlugin);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\texports.default = _domainDrivenPouchPersistencePlugin2.default;\n\tvar utils = exports.utils =  false ? require('./configureServer') : {};\n\n/***/ },\n/* 8 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\t\n\texports.default = reduxMiddleware;\n\t\n\tvar _jsonPath = __webpack_require__(11);\n\t\n\tvar _jsonPath2 = _interopRequireDefault(_jsonPath);\n\t\n\tvar _asyncFunctionQueue = __webpack_require__(9);\n\t\n\tvar _asyncFunctionQueue2 = _interopRequireDefault(_asyncFunctionQueue);\n\t\n\tvar _deepEqual = __webpack_require__(10);\n\t\n\tvar _deepEqual2 = _interopRequireDefault(_deepEqual);\n\t\n\tvar _redux = __webpack_require__(3);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _objectWithoutProperties(obj, keys) { var target = {}; for (var i in obj) { if (keys.indexOf(i) >= 0) continue; if (!Object.prototype.hasOwnProperty.call(obj, i)) continue; target[i] = obj[i]; } return target; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction warn(what) {\n\t    var fn = console.warn || console.log;\n\t    if (fn) {\n\t        fn.call(console, what);\n\t    }\n\t}\n\t\n\tfunction defaultAction(action) {\n\t    return function () {\n\t        throw new Error('no action provided for ' + action);\n\t    };\n\t}\n\t\n\tvar defaultActions = {\n\t    remove: defaultAction('remove'),\n\t    update: defaultAction('update'),\n\t    insert: defaultAction('insert')\n\t};\n\t\n\tfunction _initFromDb(path) {\n\t    if (!path.lifecycleState) {\n\t        path.lifecycleState = 'INITIALIZING';\n\t        path.db.allDocs(_extends({\n\t            include_docs: true\n\t        }, path.prefix ? {\n\t            startkey: path.prefix,\n\t            endkey: path.prefix + '￿'\n\t        } : {})).then(function (result) {\n\t            result.rows.forEach(function (row) {\n\t                return onDbChange(path, row);\n\t            });\n\t            path.lifecycleState = 'INITIALIZED';\n\t            listen(path);\n\t        }).catch(function (err) {\n\t            return console.log(err);\n\t        });\n\t    }\n\t}\n\t\n\tfunction listen(path) {\n\t    var changes = path.db.changes(_extends({\n\t        live: true, since: 'now', include_docs: true\n\t    }, path.prefix ? {\n\t        filter: function filter(_ref) {\n\t            var _id = _ref._id;\n\t            return _id.split('/')[0] == path.prefix;\n\t        }\n\t    } : {}));\n\t    changes.on('change', function (change) {\n\t        return onDbChange(path, change);\n\t    });\n\t}\n\t\n\tfunction processNewStateForPath(path, state) {\n\t    var docsContainer = _jsonPath2.default.resolve(state, path.path);\n\t\n\t    /* istanbul ignore else */\n\t    if (docsContainer && docsContainer.length && path.lifecycleState == 'INITIALIZED') {\n\t        docsContainer.forEach(function (docs) {\n\t            var _differences = differences(path.docs, docs);\n\t\n\t            var updated = _differences.updated;\n\t            var deleted = _differences.deleted;\n\t            var inserted = _differences.inserted;\n\t\n\t            inserted.concat(updated).forEach(function (doc) {\n\t                return path.insert(doc);\n\t            });\n\t            deleted.forEach(function (doc) {\n\t                return path.remove(doc);\n\t            });\n\t        });\n\t    }\n\t}\n\t\n\tvar Path = function () {\n\t    function Path(_ref2) {\n\t        var _ref2$path = _ref2.path;\n\t        var path = _ref2$path === undefined ? '.' : _ref2$path;\n\t        var _ref2$prefix = _ref2.prefix;\n\t        var prefix = _ref2$prefix === undefined ? '' : _ref2$prefix;\n\t        var db = _ref2.db;\n\t        var actions = _ref2.actions;\n\t\n\t        _classCallCheck(this, Path);\n\t\n\t        if (!db) {\n\t            throw new Error('path ' + path.path + ' needs a db');\n\t        }\n\t\n\t        this.queue = (0, _asyncFunctionQueue2.default)(1);\n\t        this.docs = {};\n\t\n\t        this.db = db;\n\t        this.path = path;\n\t        this.prefix = prefix;\n\t        this.actions = Object.assign({}, defaultActions, actions);\n\t    }\n\t\n\t    _createClass(Path, [{\n\t        key: 'insert',\n\t        value: function insert(doc) {\n\t            this.docs[doc._id] = doc;\n\t            var db = this.db;\n\t            this.queue.push(function (cb) {\n\t                db.put(doc, cb);\n\t            });\n\t        }\n\t    }, {\n\t        key: 'remove',\n\t        value: function remove(doc) {\n\t            var _this = this;\n\t\n\t            var db = this.db;\n\t            this.queue.push(function (cb) {\n\t                db.remove(doc, cb);\n\t                delete _this.docs[doc._id];\n\t            });\n\t        }\n\t    }, {\n\t        key: 'wrapActionCreators',\n\t        value: function wrapActionCreators(dispatch) {\n\t            var _this2 = this;\n\t\n\t            this.propagations = Object.keys(this.actions).reduce(function (propagations, act) {\n\t                propagations[act] = function (doc) {\n\t                    var action = _this2.actions[act](doc);\n\t                    if (action) dispatch(action);\n\t                };\n\t                return propagations;\n\t            }, {});\n\t        }\n\t    }, {\n\t        key: 'initFromDb',\n\t        value: function initFromDb() {\n\t            _initFromDb(this);\n\t        }\n\t    }]);\n\t\n\t    return Path;\n\t}();\n\t\n\tfunction differences(oldDocs, newDocs) {\n\t    var inserted = [],\n\t        updated = [],\n\t        deleted = Object.keys(oldDocs).map(function (oldDocId) {\n\t        return oldDocs[oldDocId];\n\t    });\n\t\n\t    newDocs.forEach(function (newDoc) {\n\t        if (!newDoc._id) warn('doc with no id');\n\t\n\t        deleted = deleted.filter(function (doc) {\n\t            return doc._id !== newDoc._id;\n\t        });\n\t\n\t        var oldDoc = oldDocs[newDoc._id];\n\t        if (!oldDoc) {\n\t            inserted.push(newDoc);\n\t        } else if (!(0, _deepEqual2.default)(oldDoc, newDoc)) {\n\t            updated.push(newDoc);\n\t        }\n\t    });\n\t    return { inserted: inserted, updated: updated, deleted: deleted };\n\t}\n\t\n\tfunction onDbChange(path, _ref3) {\n\t    var changeDoc = _ref3.doc;\n\t\n\t    var change = _objectWithoutProperties(_ref3, ['doc']);\n\t\n\t    if (changeDoc._deleted) {\n\t        if (path.docs[changeDoc._id]) {\n\t            delete path.docs[changeDoc._id];\n\t            path.propagations.remove(changeDoc);\n\t        }\n\t    } else {\n\t        var oldDoc = path.docs[changeDoc._id];\n\t        path.docs[changeDoc._id] = changeDoc;\n\t        if (oldDoc) {\n\t            path.propagations.update(changeDoc);\n\t        } else {\n\t            path.propagations.insert(changeDoc);\n\t        }\n\t    }\n\t}\n\t\n\tfunction reduxMiddleware() {\n\t    var paths = arguments.length <= 0 || arguments[0] === undefined ? [] : arguments[0];\n\t\n\t    if (!Array.isArray(paths)) paths = [paths];\n\t\n\t    if (!paths.length) throw new Error('PouchMiddleware: no paths');\n\t\n\t    paths = paths.map(function (options) {\n\t        return new Path(options);\n\t    });\n\t\n\t    return function (_ref4) {\n\t        var dispatch = _ref4.dispatch;\n\t        var getState = _ref4.getState;\n\t\n\t        paths.forEach(function (path) {\n\t            path.wrapActionCreators(dispatch);\n\t            path.initFromDb();\n\t        });\n\t        return function (next) {\n\t            return function (action) {\n\t                var nextAction = next(action);\n\t                paths.forEach(function (path) {\n\t                    return processNewStateForPath(path, getState());\n\t                });\n\t                return nextAction;\n\t            };\n\t        };\n\t    };\n\t}\n\n/***/ },\n/* 9 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"async-function-queue\");\n\n/***/ },\n/* 10 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"deep-equal\");\n\n/***/ },\n/* 11 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"json-path\");\n\n/***/ },\n/* 12 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"pouchdb\");\n\n/***/ },\n/* 13 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"pouchdb-authentication\");\n\n/***/ },\n/* 14 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"react\");\n\n/***/ },\n/* 15 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"strictduck-domain-driven-fullstack\");\n\n/***/ }\n/******/ ]);\n\n\n/** WEBPACK FOOTER **\n ** browser.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 2d949a9d6f1ac3fde22c\n **/","import { bindActionCreators } from 'redux'\nimport reduxMiddleware from './reduxMiddleware'\n\nfunction invert(obj){\n    return Object.keys(obj).reduce(\n        (inversion, key) => {\n            inversion[obj[key]] = key\n            return inversion\n        }\n    ,{})\n}\n\nfunction dbActions({domain: {actions = {}, pouchActionMap: actionMap={insert: 'insert', update: 'update', remove: 'remove'} }}){\n    let invertedActionMap = invert(actionMap) \n    let acts = Object.keys(actions)\n        .filter(a => [actionMap.update, actionMap.insert, actionMap.remove].indexOf(a) >= 0 )\n        .reduce((dbActs, a) => {\n            dbActs[invertedActionMap[a]] = doc => {\n                try {\n                    return actions[a](doc)\n                } catch(e) {\n                    if(e instanceof TypeError){\n                        return\n                    } else {\n                        throw e\n                    }\n                }\n            }\n            return dbActs\n        }, {})\n    return Object.keys(acts).length ? acts : false\n}\n\nexport default function domainDrivenReduxMiddleware({db, domains}){\n    return reduxMiddleware(\n        Object.values(domains)\n            .filter(domain => dbActions({ domain }))\n            .map(domain => domain)\n            .map( domain => ({\n                path: `/${domain.prefix}`,\n                prefix: `${domain.dbPrefix || ''}`,\n                db,\n                actions: dbActions({ domain })\n            }))\n    )\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/domainMiddlewareGenerator.js\n **/","import React from 'react'\nexport defaultDataFlows from './dataFlows'\n\nexport function requireAuthWithPersister({path, persister}) {\n    return function requireAuth(nextState, replace, callback) {\n        let redirect = _ => {\n            replace({ nextPathname: nextState.location.pathname }, path)\n            callback()\n        }\n        (persister || this.db).getSession( (err, response) => {\n            if (err) {\n                console.log(err)\n                redirect()\n            } else if (!response.userCtx.name) {\n                redirect()\n            } else {\n                callback()\n            }\n        });\n    }\n}\n\nexport function requireAuthFromRoute(path){\n    return {\n        requiresAuthentication: true,\n        path \n    }\n}\n\nexport function provideAuthFromRoute(component) {\n    var placeholder = _=>_\n    Object.assign(placeholder, {\n        providesAuthentication: true,\n        component\n    })\n    return placeholder\n}\n\nfunction authenticateRouteBasedOnOnEnter({route, persister}){\n    return (route.props.onEnter && route.props.onEnter.requiresAuthentication) ? {\n        onEnter: requireAuthWithPersister({path: route.props.onEnter.path, persister})\n    } : {}\n}\n\nfunction authenticateFromRouteBasedOnComponent({route, persister}) {\n    return (route.props.component && route.props.component.providesAuthentication) ?  {\n        component: (props) => <route.props.component.component auth={persister} {...props}/>\n    } : {}\n}\n\nexport function authenticateRoutes(route, persister){\n    persister = persister || this.db\n    return React.cloneElement(\n        route,\n        {\n            ...authenticateRouteBasedOnOnEnter({route, persister}),\n            ...authenticateFromRouteBasedOnComponent({route, persister}),\n            key: route.props.path\n        },\n        route.props.children ?\n            route.props.children.map(route => authenticateRoutes(route, persister)) :\n            undefined\n    )\n}\n\nfunction provideInjection(dependentFunction, persister){\n    return (...args) => dependentFunction(persister || this.db, ...args)\n}\n\nfunction provideInjectionToHandlers(route, persister){\n    console.log(route)\n    route.handlers = route.handlers.map(\n        handler => handler.requiresPersister ?\n           provideInjection(handler.dependentFunction, persister) :\n           handler\n    )\n    return route\n}\n\n\nfunction expandPersisterBackedDomain(domain, persister){\n    let routes = domain.get('routes')\n    Object.keys(domain.get('routes'))\n        .map(route => domain.register('routes', route, provideInjectionToHandlers(routes[route], persister)))\n    return domain\n}\n\nexport function provideInjectionForDomainRouteHandlers(domains, persister){\n    persister = persister || this.db\n    return Object.keys(domains)\n        .reduce((newDomains, k) => {\n            newDomains[k] = expandPersisterBackedDomain(domains[k], persister);\n            return newDomains\n        }, {})\n}\n\nexport function requireInjection(dependentFunction){\n    return {\n        requiresPersister: true,\n        dependentFunction\n    }\n}\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/utils.js\n **/","module.exports = require(\"redux\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"redux\"\n ** module id = 3\n ** module chunks = 0\n **/","export default {\n    INSERT(state, payload){\n        return [payload, ...state]\n    },\n    UPDATE(state, payload){\n        return state.map(doc => doc._id == payload._id ? payload : doc)\n    },\n    REMOVE(state, {_id}){\n        return state.filter(doc => doc._id != _id)\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/dataFlows.js\n **/","import PouchDB from 'pouchdb'\nimport PouchDbAuthentication from 'pouchdb-authentication'\n\nPouchDB.plugin(PouchDbAuthentication)\n\nfunction fullUri({name, uri}){\n    return `${uri}/${name}`\n}\n\nexport default function db(settings){\n   return new PouchDB(fullUri(settings), {skipSetup: true})\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/db.js\n **/","import { storePersistencePlugin } from 'strictduck-domain-driven-fullstack'\nimport domainMiddlewareGenerator from './domainMiddlewareGenerator'\nimport init from './db'\nimport { authenticateRoutes, provideAuthFromRoute, provideInjectionForDomainRouteHandlers } from './utils'\n\nconst provide = ($ES.CONTEXT == 'NODE' ? require('./configureServer') : require('./domainMiddlewareGenerator')).default\nconst putDb = ($ES.CONTEXT == 'NODE' ? require('./configureServer').ensureRemoteExistence : _ => _)\n\nexport default storePersistencePlugin.implement({\n    name: 'DomainDrivenPouchPersistencePlugin',\n    constructor({ Domains: { settings: { db } } }){\n        putDb(db)\n        return [{\n            db: init(db),\n            middlewareGenerator: domainMiddlewareGenerator,\n            authenticateRoutes,\n            provideAuthFromRoute,\n            provideInjectionForDomainRouteHandlers\n        }]\n    },\n    provider(...args){\n        return provide.bind(this.db)(...args)\n    }\n})\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/domainDrivenPouchPersistencePlugin.js\n **/","export default from './domainDrivenPouchPersistencePlugin'\n\nexport const utils = ($ES.CONTEXT == 'NODE' ? require('./configureServer') : {})\n\nexport * from './utils'\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/index.js\n **/","import jPath from 'json-path'\nimport Queue from 'async-function-queue'\nimport equal from 'deep-equal'\nimport { bindActionCreators } from 'redux'\n\nfunction warn(what) {\n    var fn = console.warn || console.log;\n    if (fn) {\n        fn.call(console, what);\n    }\n}\n\nfunction defaultAction(action) {\n    return function() {\n        throw new Error('no action provided for ' + action);\n    };\n}\n\nconst defaultActions = {\n    remove: defaultAction('remove'),\n    update: defaultAction('update'),\n    insert: defaultAction('insert')\n}\n\n\nfunction initFromDb(path) {\n    if(!path.lifecycleState){\n        path.lifecycleState = 'INITIALIZING'\n        path.db.allDocs({\n            include_docs: true,\n            ...(path.prefix ? {\n                startkey: path.prefix,\n                endkey: `${path.prefix}\\uffff`\n            } : {})\n        }).then(result => {\n            result.rows.forEach(row => onDbChange(path, row))\n            path.lifecycleState = 'INITIALIZED'\n            listen(path)\n        }).catch(err => console.log(err))\n    }\n}\n\nfunction listen(path) {\n    var changes = path.db.changes({\n        live: true, since: 'now', include_docs: true,\n        ...(path.prefix ? {\n            filter: ({_id}) => _id.split('/')[0] == path.prefix\n            } : {})\n    });\n    changes.on('change', change => onDbChange(path, change));\n}\n\n\nfunction processNewStateForPath(path, state) {\n    var docsContainer = jPath.resolve(state, path.path);\n\n    /* istanbul ignore else */\n    if (docsContainer && docsContainer.length && path.lifecycleState == 'INITIALIZED' ){\n        docsContainer.forEach(docs => {\n            var {updated, deleted, inserted} = differences(path.docs, docs)\n            inserted.concat(updated).forEach(doc => path.insert(doc))\n            deleted.forEach(doc => path.remove(doc))\n        });\n    }\n}\n\nclass Path {\n  constructor({path = '.', prefix = '', db, actions}) {\n      if (! db) {\n          throw new Error('path ' + path.path + ' needs a db');\n      }\n\n      this.queue = Queue(1)\n      this.docs = {}\n\n      this.db = db\n      this.path = path\n      this.prefix = prefix\n      this.actions = Object.assign({}, defaultActions, actions)\n  }\n\n  insert(doc) {\n      this.docs[doc._id] = doc\n      var db = this.db\n      this.queue.push(cb => {\n          db.put(doc, cb)\n      })\n  }\n\n  remove(doc) {\n      var db = this.db\n      this.queue.push(cb => {\n          db.remove(doc, cb)\n          delete this.docs[doc._id]\n      })\n  }\n\n  wrapActionCreators(dispatch){\n      this.propagations = Object.keys(this.actions).reduce(\n          (propagations, act) => {\n              propagations[act] = doc => {\n                  let action = this.actions[act](doc)\n                  if(action) dispatch(action)\n              }\n              return propagations\n          }, {}\n      )\n  }\n\n  initFromDb(){ initFromDb(this) }\n  \n}\n\nfunction differences(oldDocs, newDocs) {\n    var inserted = [],\n        updated = [],\n        deleted = Object.keys(oldDocs).map(oldDocId => oldDocs[oldDocId]);\n\n    newDocs.forEach(newDoc => {\n        if (! newDoc._id) warn('doc with no id');\n\n        deleted = deleted.filter(doc => doc._id !== newDoc._id);\n\n        var oldDoc = oldDocs[newDoc._id];\n        if (! oldDoc) {\n            inserted.push(newDoc);\n        } else if (!equal(oldDoc, newDoc)) {\n            updated.push(newDoc);\n        }\n    });\n    return {inserted, updated, deleted}\n}\n\nfunction onDbChange(path, {doc: changeDoc, ...change}) {\n    if (changeDoc._deleted) {\n        if (path.docs[changeDoc._id]) {\n            delete path.docs[changeDoc._id];\n            path.propagations.remove(changeDoc);\n        }\n    } else {\n        var oldDoc = path.docs[changeDoc._id];\n        path.docs[changeDoc._id] = changeDoc;\n        if (oldDoc) {\n            path.propagations.update(changeDoc);\n        } else {\n            path.propagations.insert(changeDoc);\n        }\n    }\n}\n\nexport default function reduxMiddleware(paths = []) {\n    if (!Array.isArray(paths)) \n        paths = [paths];\n\n    if (!paths.length)\n        throw new Error('PouchMiddleware: no paths');\n\n    paths = paths.map(options => new Path(options))\n\n\n    return ({dispatch, getState}) => {\n        paths.forEach(path => {\n            path.wrapActionCreators(dispatch)\n            path.initFromDb()\n        })\n        return next => action => {\n            let nextAction = next(action)\n            paths.forEach(path => processNewStateForPath(path, getState()))\n            return nextAction\n        }\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/reduxMiddleware.js\n **/","module.exports = require(\"async-function-queue\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"async-function-queue\"\n ** module id = 9\n ** module chunks = 0\n **/","module.exports = require(\"deep-equal\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"deep-equal\"\n ** module id = 10\n ** module chunks = 0\n **/","module.exports = require(\"json-path\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"json-path\"\n ** module id = 11\n ** module chunks = 0\n **/","module.exports = require(\"pouchdb\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"pouchdb\"\n ** module id = 12\n ** module chunks = 0\n **/","module.exports = require(\"pouchdb-authentication\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"pouchdb-authentication\"\n ** module id = 13\n ** module chunks = 0\n **/","module.exports = require(\"react\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"react\"\n ** module id = 14\n ** module chunks = 0\n **/","module.exports = require(\"strictduck-domain-driven-fullstack\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"strictduck-domain-driven-fullstack\"\n ** module id = 15\n ** module chunks = 0\n **/"],"sourceRoot":""}