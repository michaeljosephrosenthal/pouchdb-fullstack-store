{"version":3,"sources":["webpack:///node_production.js","webpack:///webpack/bootstrap e4f8b37fb7c74cf2d9b6","webpack:///./src/configureServer.js","webpack:///./src/db.js","webpack:///./src/utils.js","webpack:///external \"redux\"","webpack:///./src/dataFlows.js","webpack:///./src/domainDrivenPouchPersistencePlugin.js","webpack:///./src/domainMiddlewareGenerator.js","webpack:///./src/index.js","webpack:///./src/reduxMiddleware.js","webpack:///external \"async-function-queue\"","webpack:///external \"child_process\"","webpack:///external \"deep-equal\"","webpack:///external \"json-path\"","webpack:///external \"pouchdb\"","webpack:///external \"pouchdb-authentication\"","webpack:///external \"react\"","webpack:///external \"requisition\"","webpack:///external \"strictduck-domain-driven-fullstack\""],"names":["require","install","module","exports","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","_interopRequireDefault","obj","__esModule","default","_asyncToGenerator","fn","gen","apply","this","arguments","Promise","resolve","reject","step","key","arg","info","value","error","done","then","err","catchAndTrace","message","console","log","trace","injectCredentials","_ref","uri","_ref$protocols","protocols","undefined","_ref$admin","admin","name","password","filter","startsWith","replace","safeExec","command","_child_process","execSync","ensureRemoteExistence","_ref2","_ref2$credentials","credentials","endpoint","Object","defineProperty","_extends","assign","target","i","length","source","prototype","hasOwnProperty","createSuperAdmin","ref","regeneratorRuntime","mark","_callee","_ref3","resp","_resp","wrap","_context","prev","next","_requisition2","put","send","sent","t0","status","login","abrupt","t1","stop","_x","initUser","_callee2","_ref4","_context2","signup","_x2","initDbUsers","_callee3","_ref5","_ref5$credentials","users","_context3","bind","forEach","_x3","_requisition","_db","configure","_x4","_callee4","_ref6","_ref6$settings$db","settings","db","_context4","fullUri","_pouchdb2","skipSetup","_pouchdb","_pouchdbAuthentication","_pouchdbAuthentication2","plugin","requireAuthWithPersister","path","persister","nextState","callback","redirect","_","nextPathname","location","pathname","getSession","response","userCtx","requireAuthFromRoute","requiresAuthentication","provideAuthFromRoute","component","placeholder","providesAuthentication","authenticateRouteBasedOnOnEnter","route","props","onEnter","authenticateFromRouteBasedOnComponent","_react2","createElement","auth","applyToChildren","children","block","Array","isArray","map","authenticateRoutes","cloneElement","provideInjection","dependentFunction","_this","_len","args","_key","concat","provideInjectionToHandlers","handlers","handler","requiresPersister","expandPersisterBackedDomain","domain","routes","get","keys","register","provideInjectionForDomainRouteHandlers","domains","reduce","newDomains","k","requireInjection","defaultDataFlows","_react","_dataFlows","_dataFlows2","_toConsumableArray","arr","arr2","from","INSERT","state","payload","UPDATE","doc","_id","REMOVE","_strictduckDomainDrivenFullstack","_domainMiddlewareGenerator","_domainMiddlewareGenerator2","_db2","_utils","provide","putDb","storePersistencePlugin","implement","constructor","Domains","middlewareGenerator","provider","invert","inversion","dbActions","_ref$domain","_ref$domain$actions","actions","_ref$domain$pouchActi","pouchActionMap","actionMap","defaultActionMap","invertedActionMap","acts","a","update","insert","remove","indexOf","dbActs","e","TypeError","domainDrivenReduxMiddleware","_reduxMiddleware2","values","prefix","dbPrefix","_reduxMiddleware","utils","enumerable","_domainDrivenPouchPersistencePlugin","_domainDrivenPouchPersistencePlugin2","_objectWithoutProperties","_classCallCheck","instance","Constructor","warn","what","defaultAction","action","Error","_initFromDb","lifecycleState","allDocs","include_docs","startkey","endkey","result","rows","row","onDbChange","listen","changes","live","since","split","on","change","processNewStateForPath","docsContainer","_jsonPath2","docs","_differences","differences","updated","deleted","inserted","oldDocs","newDocs","oldDocId","newDoc","oldDoc","_deepEqual2","push","changeDoc","_deleted","propagations","reduxMiddleware","paths","options","Path","dispatch","getState","wrapActionCreators","initFromDb","nextAction","_createClass","defineProperties","descriptor","configurable","writable","protoProps","staticProps","_jsonPath","_asyncFunctionQueue","_asyncFunctionQueue2","_deepEqual","defaultActions","_ref2$path","_ref2$prefix","queue","cb","_this2","act","_this3","once"],"mappings":"AAAAA,QAAQ,sBAAsBC,UAC9BC,OAAOC,QACE,SAAUC,GCEnB,QAAAC,GAAAC,GAGA,GAAAC,EAAAD,GACA,MAAAC,GAAAD,GAAAH,OAGA,IAAAD,GAAAK,EAAAD,IACAH,WACAK,GAAAF,EACAG,QAAA,EAUA,OANAL,GAAAE,GAAAI,KAAAR,EAAAC,QAAAD,IAAAC,QAAAE,GAGAH,EAAAO,QAAA,EAGAP,EAAAC,QAvBA,GAAAI,KAqCA,OATAF,GAAAM,EAAAP,EAGAC,EAAAO,EAAAL,EAGAF,EAAAQ,EAAA,GAGAR,EAAA,KDQM,SAASH,EAAQC,EAASE,GAE/BH,EAAOC,QAAUE,EAAoB,IAKhC,SAASH,EAAQC,EAASE,GAE/B,YAmKA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAASF,GAEvF,QAASG,GAAkBC,GAAM,MAAO,YAAc,GAAIC,GAAMD,EAAGE,MAAMC,KAAMC,UAAY,OAAO,IAAIC,SAAQ,SAAUC,EAASC,GAAU,QAASC,GAAKC,EAAKC,GAAO,IAAM,GAAIC,GAAOV,EAAIQ,GAAKC,GAAUE,EAAQD,EAAKC,MAAS,MAAOC,GAAwB,WAAfN,GAAOM,GAAkB,MAAIF,GAAKG,SAAQR,GAAQM,GAAwBP,QAAQC,QAAQM,GAAOG,KAAK,SAAUH,GAAS,MAAOJ,GAAK,OAAQI,IAAW,SAAUI,GAAO,MAAOR,GAAK,QAASQ,KAAc,MAAOR,GAAK,WExNxc,QAASS,GAAcC,EAASF,GAC5BG,QAAQC,IAAIF,EAASF,GACrBG,QAAQE,MAAML,GAGlB,QAASM,GAATC,GAAwF,GAA5DC,GAA4DD,EAA5DC,IAA4DC,EAAAF,EAAvDG,YAAuDC,SAAAF,GAA5C,OAAQ,SAAoCA,EAAAG,EAAAL,EAA1BM,MAAQC,EAAkBF,EAAlBE,KAAMC,EAAYH,EAAZG,SACpErC,EAAIgC,EAAUM,OAAO,SAAAtC,GAAA,MAAK8B,GAAIS,WAAcvC,EAAlB,SAA2B,GAAK,KAC9D,OAAO8B,GAAIU,QAAQxC,EAAZ,GAAkBA,EAAIoC,EAAtB,IAA8BC,EAA9B,KAGX,QAASI,GAASC,GACd,KACI,EAAAC,EAAAC,UAASF,GACX,MAAMpB,GACJG,QAAQC,IAAR,YAAwBgB,EAAxB,4BAA2DpB,IAI5D,QAASuB,GAATC,GAAsE,GAAtChB,GAAsCgB,EAAtChB,IAAKM,EAAiCU,EAAjCV,KAAiCW,EAAAD,EAA3BE,WAA2BD,GAAAd,SAAAc,MAAA,IAAbZ,GAAaY,EAAbZ,KACzDA,IACCM,EAAA,2BAAoCN,EAAME,SAA1C,KAAuDP,EAAvD,mBAA6EK,EAAMC,KAEvF,IAAIa,GAAWd,EAAQP,GAAmBE,IAAQA,EAAR,IAAeM,EAAQD,UAAaL,EAA/D,IAAsEM,CACrFK,GAAA,uBAAgCQ,GF8BnCC,OAAOC,eAAe7D,EAAS,cAC3B4B,OAAO,GAGX,IAAIkC,GAAWF,OAAOG,QAAU,SAAUC,GAAU,IAAK,GAAIC,GAAI,EAAGA,EAAI7C,UAAU8C,OAAQD,IAAK,CAAE,GAAIE,GAAS/C,UAAU6C,EAAI,KAAK,GAAIxC,KAAO0C,GAAcP,OAAOQ,UAAUC,eAAe9D,KAAK4D,EAAQ1C,KAAQuC,EAAOvC,GAAO0C,EAAO1C,IAAY,MAAOuC,IAEnPM,EAAmB,WACnB,GAAIC,GAAMxD,EAAkByD,mBAAmBC,KElCpD,QAAAC,GAAAC,GAAA,GAEYC,GAaAC,EAfsBrC,EAAlCmC,EAAkCnC,IAAKM,EAAvC6B,EAAuC7B,KAAMC,EAA7C4B,EAA6C5B,QAA7C,OAAAyB,oBAAAM,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,aAAAF,GAAAC,KAAA,EAAAD,EAAAE,KAAA,EAEyBC,aACZC,IAAO3C,EADK,mBACiBM,GAC7BsC,KAFY,IAEHrC,EAFG,IAFzB,QAEY6B,EAFZG,EAAAM,KAKQlD,QAAQC,IAAI,wBALpB2C,EAAAE,KAAA,gBAAAF,EAAAC,KAAA,EAAAD,EAAAO,GAAAP,EAAA,YAOyB,KAAdA,EAAAO,GAAIC,OACHtD,EAAc,4BAAd8C,EAAAO,IAEAnD,QAAQC,IAAI,8BAVxB,eAAA2C,GAAAC,KAAA,GAAAD,EAAAE,KAAA,GAeyB9D,KAAKqE,MAAM1C,EAAMC,EAf1C,eAeY8B,GAfZE,EAAAM,KAgBQlD,QAAQC,IAAI,0BAhBpB2C,EAAAU,OAAA,SAiBeZ,EAjBf,SAAAE,EAAAC,KAAA,GAAAD,EAAAW,GAAAX,EAAA,aAmBQ9C,EAAc,8BAAd8C,EAAAW,GAnBR,yBAAAX,GAAAY,SAAAjB,EAAAvD,OAAA,iBF4FK,OAAO,UAA0ByE,GAC7B,MAAOrB,GAAIrD,MAAMC,KAAMC,eAI3ByE,EAAW,WACX,GAAItB,GAAMxD,EAAkByD,mBAAmBC,KE3EpD,QAAAqB,GAAAC,GAAA,GAAyBjD,GAAzBiD,EAAyBjD,KAAMC,EAA/BgD,EAA+BhD,QAA/B,OAAAyB,oBAAAM,KAAA,SAAAkB,GAAA,cAAAA,EAAAhB,KAAAgB,EAAAf,MAAA,aAAAe,GAAAhB,KAAA,EAAAgB,EAAAf,KAAA,EAEc9D,KAAK8E,OAAOnD,EAAMC,EAFhC,QAAAiD,EAAAf,KAAA,eAAAe,EAAAhB,KAAA,EAAAgB,EAAAV,GAAAU,EAAA,YAIyB,KAAdA,EAAAV,GAAIC,OACHtD,EAAc,4BAAd+D,EAAAV,IAEAnD,QAAQC,IAAR,QAAoBU,EAApB,kBAPZ,wBAAAkD,GAAAL,SAAAG,EAAA3E,OAAA,SF4GK,OAAO,UAAkB+E,GACrB,MAAO3B,GAAIrD,MAAMC,KAAMC,eAI3B+E,EAAc,WACd,GAAI5B,GAAMxD,EAAkByD,mBAAmBC,KEtGpD,QAAA2B,GAAAC,GAAA,GACI7D,GADJ6D,EACI7D,IADJ8D,EAAAD,EACS3C,YAAcb,EADvByD,EACuBzD,MAAO0D,EAD9BD,EAC8BC,KAD9B,OAAA/B,oBAAAM,KAAA,SAAA0B,GAAA,cAAAA,EAAAxB,KAAAwB,EAAAvB,MAAA,aAAAuB,GAAAxB,KAAA,EAAAwB,EAAAvB,KAAA,EAIcX,EAAiBmC,KAAKtF,MAAtB2C,GAA8BtB,OAAQK,GAJpD,QAAA2D,EAAAvB,KAAA,eAAAuB,EAAAxB,KAAA,EAAAwB,EAAAlB,GAAAkB,EAAA,YAMQvE,EAAc,uBAAduE,EAAAlB,GANR,QAQIiB,EAAMG,QAAQb,EAASY,KAAKtF,MARhC,wBAAAqF,GAAAb,SAAAS,EAAAjF,OAAA,SFwIK,OAAO,UAAqBwF,GACxB,MAAOpC,GAAIrD,MAAMC,KAAMC,cAI/BpB,GExLeuD,uBAtBhB,IAAAqD,GAAA1G,EAAA,IFkNKgF,EAAgBvE,EAAuBiG,GEjN5CC,EAAA3G,EAAA,GACAmD,GFoNY1C,EAAuBkG,GEpNnC3G,EAAA,IFqQCF,cAAkB,WAmBd,QE9MyB8G,GF8MNC,GACf,MAAOxC,GAAIrD,MAAMC,KAAMC,WAnB3B,GAAImD,GAAMxD,EAAkByD,mBAAmBC,KE5LrC,QAAAuC,GAAAC,GAAA,GAAAC,GAAAD,EACXE,SAAYC,GAAK5E,EADN0E,EACM1E,IAAKkB,EADXwD,EACWxD,WADX,OAAAc,oBAAAM,KAAA,SAAAuC,GAAA,cAAAA,EAAArC,KAAAqC,EAAApC,MAAA,OAGRvB,GACCyC,EAAYM,KAAKtF,OAAOqB,MAAKkB,eAJtB,wBAAA2D,GAAA1B,SAAAqB,EAAA7F,QFkNV,OElNyB2F,OFuNxB,SAAS/G,EAAQC,EAASE,GAE/B,YAeA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAASF,GG/SxF,QAAS0G,GAAT/E,GAA6B,GAAXO,GAAWP,EAAXO,KAAMN,EAAKD,EAALC,GACpB,OAAUA,GAAV,IAAiBM,EAGN,QAASsE,GAAGD,GACxB,MAAO,IAAAI,cAAYD,EAAQH,IAAYK,WAAW,IH6RpD5D,OAAOC,eAAe7D,EAAS,cAC5B4B,OAAO,IAEV5B,aGjSuBoH,CATxB,IAAAK,GAAAvH,EAAA,IH8SKqH,EAAY5G,EAAuB8G,GG7SxCC,EAAAxH,EAAA,IHiTKyH,EAA0BhH,EAAuB+G,EG/StDH,cAAQK,OAARD,eHkUM,SAAS5H,EAAQC,EAASE,GAE/B,YAwBA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAASF,GI5VjF,QAASiH,GAATtF,GAAqD,GAAlBuF,GAAkBvF,EAAlBuF,KAAMC,EAAYxF,EAAZwF,SAC5C,OAAO,UAAqBC,EAAW9E,EAAS+E,GAC5C,GAAIC,GAAW,SAAAC,GACXjF,GAAUkF,aAAcJ,EAAUK,SAASC,UAAYR,GACvDG,MAEHF,GAAa5G,KAAKiG,IAAImB,WAAY,SAACvG,EAAKwG,GACjCxG,GACAG,QAAQC,IAAIJ,GACZkG,KACQM,EAASC,QAAQ3F,KAGzBmF,IAFAC,OAQT,QAASQ,GAAqBZ,GACjC,OACIa,wBAAwB,EACxBb,QAID,QAASc,GAAqBC,GACjC,GAAIC,GAAc,SAAAX,GAAA,MAAGA,GAKrB,OAJAvE,QAAOG,OAAO+E,GACVC,wBAAwB,EACxBF,cAEGC,EAGX,QAASE,GAATxF,GAA4D,GAAlByF,GAAkBzF,EAAlByF,MAAOlB,EAAWvE,EAAXuE,SAC7C,OAAQkB,GAAMC,MAAMC,SAAWF,EAAMC,MAAMC,QAAQR,wBAC/CQ,QAAStB,GAA0BC,KAAMmB,EAAMC,MAAMC,QAAQrB,KAAMC,kBAI3E,QAASqB,GAATzE,GAAmE,GAAnBsE,GAAmBtE,EAAnBsE,MAAOlB,EAAYpD,EAAZoD,SACnD,OAAQkB,GAAMC,MAAML,WAAaI,EAAMC,MAAML,UAAUE,wBACnDF,UAAW,SAACK,GAAD,MAAWG,cAAAC,cAACL,EAAMC,MAAML,UAAUA,UAAvB/E,GAAiCyF,KAAMxB,GAAemB,SAIpF,QAASM,GAATzD,GAA2C,GAAjB0D,GAAiB1D,EAAjB0D,SAAUC,EAAO3D,EAAP2D,KAChC,OAAGD,GACQE,MAAMC,QAAQH,GACjBA,EAASI,IAAIH,GACbA,EAAMD,GAEHA,EAIR,QAASK,GAAmBb,EAAOlB,GAEtC,MADAA,GAAYA,GAAa5G,KAAKiG,GACvBiC,aAAMU,aACTd,EADGnF,KAGIkF,GAAiCC,QAAOlB,cACxCqB,GAAuCH,QAAOlB,eACjDtG,IAAKwH,EAAMC,MAAMpB,OAErB0B,GACIC,SAAUR,EAAMC,MAAMO,SACtBC,MAAO,SAAAT,GAAA,MAASa,GAAmBb,EAAOlB,OAKtD,QAASiC,GAAiBC,EAAmBlC,GAAU,GAAAmC,GAAA/I,IACnD,OAAO,mBAAAgJ,GAAA/I,UAAA8C,OAAIkG,EAAJT,MAAAQ,GAAAE,EAAA,EAAAF,EAAAE,MAAID,EAAJC,GAAAjJ,UAAAiJ,EAAA,OAAaJ,GAAA/I,MAAAyB,QAAkBoF,GAAamC,EAAK9C,IAApCkD,OAA2CF,KAGnE,QAASG,GAA2BtB,EAAOlB,GAMvC,MALAkB,GAAMuB,SAAWvB,EAAMuB,SAASX,IAC5B,SAAAY,GAAA,MAAWA,GAAQC,kBAChBV,EAAiBS,EAAQR,kBAAmBlC,GAC5C0C,IAEAxB,EAIX,QAAS0B,GAA4BC,EAAQ7C,GACzC,GAAI8C,GAASD,EAAOE,IAAI,SAGxB,OAFAlH,QAAOmH,KAAKH,EAAOE,IAAI,WAClBjB,IAAI,SAAAZ,GAAA,MAAS2B,GAAOI,SAAS,SAAU/B,EAAOsB,EAA2BM,EAAO5B,GAAQlB,MACtF6C,EAGJ,QAASK,GAAuCC,EAASnD,GAE5D,MADAA,GAAYA,GAAa5G,KAAKiG,GACvBxD,OAAOmH,KAAKG,GACdC,OAAO,SAACC,EAAYC,GAEjB,MADAD,GAAWC,GAAKV,EAA4BO,EAAQG,GAAItD,GACjDqD,OAIZ,QAASE,GAAiBrB,GAC7B,OACIS,mBAAmB,EACnBT,qBJ4NPrG,OAAOC,eAAe7D,EAAS,cAC3B4B,OAAO,IAEX5B,EAAQuL,iBAAmB5I,MAE3B,IAAImB,GAAWF,OAAOG,QAAU,SAAUC,GAAU,IAAK,GAAIC,GAAI,EAAGA,EAAI7C,UAAU8C,OAAQD,IAAK,CAAE,GAAIE,GAAS/C,UAAU6C,EAAI,KAAK,GAAIxC,KAAO0C,GAAcP,OAAOQ,UAAUC,eAAe9D,KAAK4D,EAAQ1C,KAAQuC,EAAOvC,GAAO0C,EAAO1C,IAAY,MAAOuC,GAEvPhE,GI7Ue6H,2BJ8Uf7H,EI3Te0I,uBJ4Tf1I,EIrTe4I,uBJsTf5I,EIvRe8J,qBJwRf9J,EInPeiL,yCJoPfjL,EI3OesL,kBA1GhB,IAAAE,GAAAtL,EAAA,IJyVKmJ,EAAU1I,EAAuB6K,GAEjCC,EAAavL,EAAoB,GAEjCwL,EAAc/K,EAAuB8K,EAIzCzL,GIhWMuL,iBJgWqBG,cAgItB,SAAS3L,EAAQC,GKjevBD,EAAAC,QAAAH,QAAA,ULueM,SAASE,EAAQC,GAEtB,YAMA,SAAS2L,GAAmBC,GAAO,GAAIjC,MAAMC,QAAQgC,GAAM,CAAE,IAAK,GAAI3H,GAAI,EAAG4H,EAAOlC,MAAMiC,EAAI1H,QAASD,EAAI2H,EAAI1H,OAAQD,IAAO4H,EAAK5H,GAAK2H,EAAI3H,EAAM,OAAO4H,GAAe,MAAOlC,OAAMmC,KAAKF,GAJ1LhI,OAAOC,eAAe7D,EAAS,cAC3B4B,OAAO,IAKX5B,cMhfG+L,OADW,SACJC,EAAOC,GACV,OAAQA,GAAR3B,OAAAqB,EAAoBK,KAExBE,OAJW,SAIJF,EAAOC,GACV,MAAOD,GAAMnC,IAAI,SAAAsC,GAAA,MAAOA,GAAIC,KAAOH,EAAQG,IAAMH,EAAUE,KAE/DE,OAPW,SAOJL,EAPIzJ,GAOS,GAAL6J,GAAK7J,EAAL6J,GACX,OAAOJ,GAAMhJ,OAAO,SAAAmJ,GAAA,MAAOA,GAAIC,KAAOA,ON6fxC,SAASrM,EAAQC,EAASE,GAE/B,YAkBA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAASF,GAhBvFgD,OAAOC,eAAe7D,EAAS,cAC3B4B,OAAO,GO1gBZ,IAAA0K,GAAApM,EAAA,IACAqM,EAAArM,EAAA,GPghBKsM,EAA8B7L,EAAuB4L,GO/gB1D1F,EAAA3G,EAAA,GPmhBKuM,EAAO9L,EAAuBkG,GOlhBnC6F,EAAAxM,EAAA,GAEMyM,EAAmCzM,EAAQ,GAAjC,WACV0M,EAAiC1M,EAAQ,GAAqBqD,qBP0hBnEvD,cOxhBcsM,EAAAO,uBAAuBC,WAClChK,KAAM,qCACNiK,YAF4C,SAAAxK,GAEE,GAAT6E,GAAS7E,EAAhCyK,QAAW7F,SAAYC,EAEjC,OADAwF,GAAMxF,KAEFA,IAAI,EAAAqF,cAAKrF,GACT6F,oBAAAT,aACA1C,mBAAA4C,EAAA5C,mBACAlB,qBAAA8D,EAAA9D,qBACAqC,uCAAAyB,EAAAzB,0CAGRiC,SAZ4C,WAaxC,MAAOP,GAAQlG,KAAKtF,KAAKiG,IAAlBlG,MAAAyB,OAAAvB,ePgiBT,SAASrB,EAAQC,EAASE,GAE/B,YAaA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAASF,GQjkBxF,QAASuM,GAAOvM,GACZ,MAAOgD,QAAOmH,KAAKnK,GAAKuK,OACpB,SAACiC,EAAW3L,GAER,MADA2L,GAAUxM,EAAIa,IAAQA,EACf2L,OAMnB,QAASC,GAAT9K,GAGG,GAAA+K,GAAA/K,EAHiBqI,OAGjB2C,EAAAD,EAFCE,UAED7K,SAAA4K,OAAAE,EAAAH,EADCI,eAAgBC,EACjBhL,SAAA8K,EAD2BG,EAC3BH,EACKI,EAAoBV,EAAOQ,GAC3BG,EAAOlK,OAAOmH,KAAKyC,GAClBxK,OAAO,SAAA+K,GAAA,OAAMJ,EAAUK,OAAQL,EAAUM,OAAQN,EAAUO,QAAQC,QAAQJ,IAAM,IACjF5C,OAAO,SAACiD,EAAQL,GAYb,MAXAK,GAAOP,EAAkBE,IAAM,SAAA5B,GAC3B,IACI,MAAOqB,GAAQO,GAAG5B,GACpB,MAAMkC,GACJ,GAAGA,YAAaC,WACZ,MAEA,MAAMD,KAIXD,MAEf,OAAOxK,QAAOmH,KAAK+C,GAAM5J,OAAS4J,GAAO,EAG9B,QAASS,GAAT/K,GAAmD,GAAb4D,GAAa5D,EAAb4D,GAAI8D,EAAS1H,EAAT0H,OACrD,QAAO,EAAAsD,cACH5K,OAAO6K,OAAOvD,GACTlI,OAAO,SAAA4H,GAAA,MAAUyC,IAAYzC,aAC7Bf,IAAK,SAAAe,GAAA,OACF9C,KAAA,IAAU8C,EAAO8D,OACjBA,OAAA,IAAW9D,EAAO+D,UAAY,IAC9BvH,KACAoG,QAASH,GAAYzC,eR4gBpChH,OAAOC,eAAe7D,EAAS,cAC3B4B,OAAO,IAEX5B,aQvhBuBuO,CArCxB,IACAK,IADA1O,EAAA,GACAA,EAAA,IRikBKsO,EAAoB7N,EAAuBiO,GQtjB5ChB,GAAoBK,OAAQ,SAAUD,OAAQ,SAAUE,OAAQ,WR+mB9D,SAASnO,EAAQC,EAASE,GAE/B,YAuBA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAASF,GArBvFgD,OAAOC,eAAe7D,EAAS,cAC7B4B,OAAO,IAET5B,EAAQ6O,MAAQ7O,aAAkB2C,MAElC,IAAI+J,GAASxM,EAAoB,EShoBlC0D,QAAAmH,KAAA2B,GAAAhG,QAAA,SAAAjF,GAAA,YAAAA,GAAAmC,OAAAC,eAAA7D,EAAAyB,GAAAqN,YAAA,EAAAhE,IAAA,iBAAA4B,GAAAjL,OT4oBC,IAAIsN,GAAsC7O,EAAoB,GAE1D8O,EAAuCrO,EAAuBoO,EAIlE/O,cAAkBgP,YSppBNhP,GAAA6O,MAAiC3O,EAAQ,ITypBhD,SAASH,EAAQC,EAASE,GAE/B,YA0BA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAASF,GAEvF,QAASqO,GAAyBrO,EAAKmK,GAAQ,GAAI/G,KAAa,KAAK,GAAIC,KAAKrD,GAAWmK,EAAKoD,QAAQlK,IAAM,GAAkBL,OAAOQ,UAAUC,eAAe9D,KAAKK,EAAKqD,KAAcD,EAAOC,GAAKrD,EAAIqD,GAAM,OAAOD,GAEnN,QAASkL,GAAgBC,EAAUC,GAAe,KAAMD,YAAoBC,IAAgB,KAAM,IAAId,WAAU,qCUtrBjH,QAASe,GAAKC,GACV,GAAItO,GAAKmB,QAAQkN,MAAQlN,QAAQC,GAC7BpB,IACAA,EAAGT,KAAK4B,QAASmN,GAIzB,QAASC,GAAcC,GACnB,MAAO,YACH,KAAM,IAAIC,OAAM,0BAA4BD,IAWpD,QAASE,GAAW5H,GAChB,MAAIA,GAAK6H,eAAT,QACI7H,EAAK6H,eAAiB,eACf7H,EAAKV,GAAGwI,QAAR9L,GACH+L,cAAc,GACV/H,EAAK4G,QACLoB,SAAUhI,EAAK4G,OACfqB,OAAWjI,EAAK4G,OAAhB,UAEL3M,KAAK,SAAAiO,GACJA,EAAOC,KAAKvJ,QAAQ,SAAAwJ,GAAA,MAAOC,GAAWrI,EAAMoI,KAC5CpI,EAAK6H,eAAiB,cACtBS,EAAOtI,MAKnB,QAASsI,GAAOtI,GACZ,GAAIuI,GAAUvI,EAAKV,GAAGiJ,QAARvM,GACVwM,MAAM,EAAMC,MAAO,MAAOV,cAAc,GACpC/H,EAAK4G,QACL1L,OAAQ,SAAAT,GAAA,GAAE6J,GAAF7J,EAAE6J,GAAF,OAAWA,GAAIoE,MAAM,KAAK,IAAM1I,EAAK4G,aAGrD2B,GAAQI,GAAG,SAAU,SAAAC,GAAA,MAAUP,GAAWrI,EAAM4I,KAIpD,QAASC,GAAuB7I,EAAMkE,GAClC,GAAI4E,GAAgBC,aAAMvP,QAAQ0K,EAAOlE,EAAKA,KAG1C8I,IAAiBA,EAAc1M,QAAiC,eAAvB4D,EAAK6H,gBAC9CiB,EAAclK,QAAQ,SAAAoK,GAAQ,GAAAC,GACSC,EAAYlJ,EAAKgJ,KAAMA,GAArDG,EADqBF,EACrBE,QAASC,EADYH,EACZG,QAASC,EADGJ,EACHI,QACvBA,GAAS7G,OAAO2G,GAASvK,QAAQ,SAAAyF,GAAA,MAAOrE,GAAKmG,OAAO9B,KACpD+E,EAAQxK,QAAQ,SAAAyF,GAAA,MAAOrE,GAAKoG,OAAO/B,OA4D/C,QAAS6E,GAAYI,EAASC,GAC1B,GAAIF,MACAF,KACAC,EAAUtN,OAAOmH,KAAKqG,GAASvH,IAAI,SAAAyH,GAAA,MAAYF,GAAQE,IAc3D,OAZAD,GAAQ3K,QAAQ,SAAA6K,GACNA,EAAOnF,KAAKiD,EAAK,kBAEvB6B,EAAUA,EAAQlO,OAAO,SAAAmJ,GAAA,MAAOA,GAAIC,MAAQmF,EAAOnF,KAEnD,IAAIoF,GAASJ,EAAQG,EAAOnF,IACtBoF,IAEM,EAAAC,cAAMD,EAAQD,IACtBN,EAAQS,KAAKH,GAFbJ,EAASO,KAAKH,MAKdJ,WAAUF,UAASC,WAG/B,QAASf,GAAWrI,EAApBnD,GAAuD,GAAvBgN,GAAuBhN,EAA5BwH,GAA4B8C,GAAAtK,GAAA,OACnD,IAAIgN,EAAUC,SACN9J,EAAKgJ,KAAKa,EAAUvF,aACbtE,GAAKgJ,KAAKa,EAAUvF,KAC3BtE,EAAK+J,aAAa3D,OAAOyD,QAE1B,CACH,GAAIH,GAAS1J,EAAKgJ,KAAKa,EAAUvF,IACjCtE,GAAKgJ,KAAKa,EAAUvF,KAAOuF,EACvBH,EACA1J,EAAK+J,aAAa7D,OAAO2D,GAEzB7J,EAAK+J,aAAa5D,OAAO0D,IAKtB,QAASG,KAA4B,GAAZC,GAAY3Q,UAAA8C,QAAA,GAAAvB,SAAAvB,UAAA,MAAAA,UAAA,EAUhD,OATKuI,OAAMC,QAAQmI,KACfA,GAASA,IAERA,EAAM7N,QACPmL,EAAK,6BAET0C,EAAQA,EAAMlI,IAAI,SAAAmI,GAAA,MAAW,IAAIC,GAAKD,KAG/B,SAAAjM,GAA0B,GAAxBmM,GAAwBnM,EAAxBmM,SAAUC,EAAcpM,EAAdoM,QAKf,OAJAJ,GAAMrL,QAAQ,SAAAoB,GACVA,EAAKsK,mBAAmBF,GACxBpK,EAAKuK,eAEF,SAAApN,GAAA,MAAQ,UAAAuK,GACX,GAAI8C,GAAarN,EAAKuK,EAEtB,OADAuC,GAAMrL,QAAQ,SAAAoB,GAAA,MAAQ6I,GAAuB7I,EAAMqK,OAC5CG,KV+elB1O,OAAOC,eAAe7D,EAAS,cAC3B4B,OAAO,GAGX,IAAI2Q,GAAe,WAAc,QAASC,GAAiBxO,EAAQkF,GAAS,IAAK,GAAIjF,GAAI,EAAGA,EAAIiF,EAAMhF,OAAQD,IAAK,CAAE,GAAIwO,GAAavJ,EAAMjF,EAAIwO,GAAW3D,WAAa2D,EAAW3D,aAAc,EAAO2D,EAAWC,cAAe,EAAU,SAAWD,KAAYA,EAAWE,UAAW,GAAM/O,OAAOC,eAAeG,EAAQyO,EAAWhR,IAAKgR,IAAiB,MAAO,UAAUrD,EAAawD,EAAYC,GAAiJ,MAA9HD,IAAYJ,EAAiBpD,EAAYhL,UAAWwO,GAAiBC,GAAaL,EAAiBpD,EAAayD,GAAqBzD,MAE5hBtL,EAAWF,OAAOG,QAAU,SAAUC,GAAU,IAAK,GAAIC,GAAI,EAAGA,EAAI7C,UAAU8C,OAAQD,IAAK,CAAE,GAAIE,GAAS/C,UAAU6C,EAAI,KAAK,GAAIxC,KAAO0C,GAAcP,OAAOQ,UAAUC,eAAe9D,KAAK4D,EAAQ1C,KAAQuC,EAAOvC,GAAO0C,EAAO1C,IAAY,MAAOuC,GAEvPhE,cUzgBuB8R,CA9JxB,IAAAgB,GAAA5S,EAAA,IV2qBK2Q,EAAalQ,EAAuBmS,GU1qBzCC,EAAA7S,EAAA,IV8qBK8S,EAAuBrS,EAAuBoS,GU7qBnDE,EAAA/S,EAAA,IVirBKuR,EAAc9Q,EAAuBsS,GUjqBpCC,GAfNhT,EAAA,IAgBIgO,OAAQqB,EAAc,UACtBvB,OAAQuB,EAAc,UACtBtB,OAAQsB,EAAc,YA6CpB0C,EVosBM,WUnsBV,QAAAA,GAAAzO,GAAoD,GAAA2P,GAAA3P,EAAvCsE,OAAuCnF,SAAAwQ,EAAhC,IAAgCA,EAAAC,EAAA5P,EAA3BkL,SAA2B/L,SAAAyQ,EAAlB,GAAkBA,EAAdhM,EAAc5D,EAAd4D,GAAIoG,EAAUhK,EAAVgK,OACtC,IADgD0B,EAAA/N,KAAA8Q,IAC1C7K,EACF,KAAM,IAAIqI,OAAM,QAAU3H,EAAKA,KAAO,cAG1C3G,MAAKkS,OAAQ,EAAAL,cAAM,GACnB7R,KAAK2P,QAEL3P,KAAKiG,GAAKA,EACVjG,KAAK2G,KAAOA,EACZ3G,KAAKuN,OAASA,EACdvN,KAAKqM,QAAU5J,OAAOG,UAAWmP,EAAgB1F,GVmwBlD,MAnDA+E,GAAaN,IACTxQ,IAAK,SACLG,MAAO,SU/sBPuK,GACHhL,KAAK2P,KAAK3E,EAAIC,KAAOD,CACrB,IAAI/E,GAAKjG,KAAKiG,EACdjG,MAAKkS,MAAM3B,KAAK,SAAA4B,GACZlM,EAAGjC,IAAIgH,EAAKmH,QVmtBb7R,IAAK,SACLG,MAAO,SUhtBPuK,GAAK,GAAAjC,GAAA/I,KACJiG,EAAKjG,KAAKiG,EACdjG,MAAKkS,MAAM3B,KAAK,SAAA4B,GACZlM,EAAG8G,OAAO/B,EAAKmH,SACRpJ,GAAK4G,KAAK3E,EAAIC,UVstBtB3K,IAAK,qBACLG,MAAO,SUntBKsQ,GAAS,GAAAqB,GAAApS,IACxBA,MAAK0Q,aAAejO,OAAOmH,KAAK5J,KAAKqM,SAASrC,OAC1C,SAAC0G,EAAc2B,GAKX,MAJA3B,GAAa2B,GAAO,SAAArH,GAChB,GAAIqD,GAAS+D,EAAK/F,QAAQgG,GAAKrH,EAC5BqD,IAAQ0C,EAAS1C,IAEjBqC,UVwtBZpQ,IAAK,aACLG,MAAO,WUptBF,GAAA6R,GAAAtS,IACRuO,GAAWvO,MAAXuO,SAAuB,SAAA1N,GACnB,GAAiB,KAAdA,EAAIuD,OAIH,KAAMvD,EAHNyR,GAAK9D,gBAAiB,EACtB8D,EAAKrM,GAAGsM,KAAK,QAAS,SAAAvL,GAAA,MAAKuH,GAAA+D,WVguB7BxB,MAiFN,SAASlS,EAAQC,GWl6BvBD,EAAAC,QAAAH,QAAA,yBXw6BM,SAASE,EAAQC,GYx6BvBD,EAAAC,QAAAH,QAAA,kBZ86BM,SAASE,EAAQC,Ga96BvBD,EAAAC,QAAAH,QAAA,ebo7BM,SAASE,EAAQC,Gcp7BvBD,EAAAC,QAAAH,QAAA,cd07BM,SAASE,EAAQC,Ge17BvBD,EAAAC,QAAAH,QAAA,Yfg8BM,SAASE,EAAQC,GgBh8BvBD,EAAAC,QAAAH,QAAA,2BhBs8BM,SAASE,EAAQC,GiBt8BvBD,EAAAC,QAAAH,QAAA,UjB48BM,SAASE,EAAQC,GkB58BvBD,EAAAC,QAAAH,QAAA,gBlBk9BM,SAASE,EAAQC,GmBl9BvBD,EAAAC,QAAAH,QAAA","file":"node_production.js","sourcesContent":["require(\"source-map-support\").install();\nmodule.exports =\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tmodule.exports = __webpack_require__(8);\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\t\n\tvar createSuperAdmin = function () {\n\t    var ref = _asyncToGenerator(regeneratorRuntime.mark(function _callee(_ref3) {\n\t        var uri = _ref3.uri;\n\t        var name = _ref3.name;\n\t        var password = _ref3.password;\n\t\n\t        var resp, _resp;\n\t\n\t        return regeneratorRuntime.wrap(function _callee$(_context) {\n\t            while (1) {\n\t                switch (_context.prev = _context.next) {\n\t                    case 0:\n\t                        _context.prev = 0;\n\t                        _context.next = 3;\n\t                        return _requisition2.default // TODO: this doesn't actually throw an error on 401\n\t                        .put(uri + '/_config/admins/' + name).send('\"' + password + '\"');\n\t\n\t                    case 3:\n\t                        resp = _context.sent;\n\t\n\t                        console.log('Server admin created');\n\t                        _context.next = 10;\n\t                        break;\n\t\n\t                    case 7:\n\t                        _context.prev = 7;\n\t                        _context.t0 = _context['catch'](0);\n\t\n\t                        if (_context.t0.status != 409) {\n\t                            catchAndTrace('error creating superadmin', _context.t0);\n\t                        } else {\n\t                            console.log('Server admin already exists');\n\t                        }\n\t\n\t                    case 10:\n\t                        _context.prev = 10;\n\t                        _context.next = 13;\n\t                        return this.login(name, password);\n\t\n\t                    case 13:\n\t                        _resp = _context.sent;\n\t\n\t                        console.log('Server admin logged in');\n\t                        return _context.abrupt('return', _resp);\n\t\n\t                    case 18:\n\t                        _context.prev = 18;\n\t                        _context.t1 = _context['catch'](10);\n\t\n\t                        catchAndTrace('error logging in superadmin', _context.t1);\n\t\n\t                    case 21:\n\t                    case 'end':\n\t                        return _context.stop();\n\t                }\n\t            }\n\t        }, _callee, this, [[0, 7], [10, 18]]);\n\t    }));\n\t\n\t    return function createSuperAdmin(_x) {\n\t        return ref.apply(this, arguments);\n\t    };\n\t}();\n\t\n\tvar initUser = function () {\n\t    var ref = _asyncToGenerator(regeneratorRuntime.mark(function _callee2(_ref4) {\n\t        var name = _ref4.name;\n\t        var password = _ref4.password;\n\t        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n\t            while (1) {\n\t                switch (_context2.prev = _context2.next) {\n\t                    case 0:\n\t                        _context2.prev = 0;\n\t                        _context2.next = 3;\n\t                        return this.signup(name, password);\n\t\n\t                    case 3:\n\t                        _context2.next = 8;\n\t                        break;\n\t\n\t                    case 5:\n\t                        _context2.prev = 5;\n\t                        _context2.t0 = _context2['catch'](0);\n\t\n\t                        if (_context2.t0.status != 409) {\n\t                            catchAndTrace('error creating superadmin', _context2.t0);\n\t                        } else {\n\t                            console.log('user ' + name + ' already exists');\n\t                        }\n\t\n\t                    case 8:\n\t                    case 'end':\n\t                        return _context2.stop();\n\t                }\n\t            }\n\t        }, _callee2, this, [[0, 5]]);\n\t    }));\n\t\n\t    return function initUser(_x2) {\n\t        return ref.apply(this, arguments);\n\t    };\n\t}();\n\t\n\tvar initDbUsers = function () {\n\t    var ref = _asyncToGenerator(regeneratorRuntime.mark(function _callee3(_ref5) {\n\t        var uri = _ref5.uri;\n\t        var _ref5$credentials = _ref5.credentials;\n\t        var admin = _ref5$credentials.admin;\n\t        var users = _ref5$credentials.users;\n\t        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n\t            while (1) {\n\t                switch (_context3.prev = _context3.next) {\n\t                    case 0:\n\t                        _context3.prev = 0;\n\t                        _context3.next = 3;\n\t                        return createSuperAdmin.bind(this)(_extends({ uri: uri }, admin));\n\t\n\t                    case 3:\n\t                        _context3.next = 8;\n\t                        break;\n\t\n\t                    case 5:\n\t                        _context3.prev = 5;\n\t                        _context3.t0 = _context3['catch'](0);\n\t\n\t                        catchAndTrace('error in initDbUsers', _context3.t0);\n\t\n\t                    case 8:\n\t                        users.forEach(initUser.bind(this));\n\t\n\t                    case 9:\n\t                    case 'end':\n\t                        return _context3.stop();\n\t                }\n\t            }\n\t        }, _callee3, this, [[0, 5]]);\n\t    }));\n\t\n\t    return function initDbUsers(_x3) {\n\t        return ref.apply(this, arguments);\n\t    };\n\t}();\n\t\n\texports.ensureRemoteExistence = ensureRemoteExistence;\n\t\n\tvar _requisition = __webpack_require__(17);\n\t\n\tvar _requisition2 = _interopRequireDefault(_requisition);\n\t\n\tvar _db = __webpack_require__(2);\n\t\n\tvar _db2 = _interopRequireDefault(_db);\n\t\n\tvar _child_process = __webpack_require__(11);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { return Promise.resolve(value).then(function (value) { return step(\"next\", value); }, function (err) { return step(\"throw\", err); }); } } return step(\"next\"); }); }; }\n\t\n\tfunction catchAndTrace(message, err) {\n\t    console.log(message, err);\n\t    console.trace(err);\n\t}\n\t\n\tfunction injectCredentials(_ref) {\n\t    var uri = _ref.uri;\n\t    var _ref$protocols = _ref.protocols;\n\t    var protocols = _ref$protocols === undefined ? ['http', 'https'] : _ref$protocols;\n\t    var _ref$admin = _ref.admin;\n\t    var name = _ref$admin.name;\n\t    var password = _ref$admin.password;\n\t\n\t    var p = protocols.filter(function (p) {\n\t        return uri.startsWith(p + '://');\n\t    })[0] + '://';\n\t    return uri.replace(p, '' + p + name + ':' + password + '@');\n\t}\n\t\n\tfunction safeExec(command) {\n\t    try {\n\t        (0, _child_process.execSync)(command);\n\t    } catch (err) {\n\t        console.log('command \"' + command + '\" failed with with error ' + err);\n\t    }\n\t}\n\t\n\tfunction ensureRemoteExistence(_ref2) {\n\t    var uri = _ref2.uri;\n\t    var name = _ref2.name;\n\t    var _ref2$credentials = _ref2.credentials;\n\t    _ref2$credentials = _ref2$credentials === undefined ? {} : _ref2$credentials;\n\t    var admin = _ref2$credentials.admin;\n\t\n\t    if (admin) {\n\t        safeExec('curl -silent -X PUT -d \\'' + admin.password + '\\' ' + uri + '/_config/admins/' + admin.name);\n\t    }\n\t    var endpoint = admin ? injectCredentials({ uri: uri + '/' + name, admin: admin }) : uri + '/' + name;\n\t    safeExec('curl -silent -X PUT ' + endpoint);\n\t}\n\t\n\texports.default = function () {\n\t    var ref = _asyncToGenerator(regeneratorRuntime.mark(function _callee4(_ref6) {\n\t        var _ref6$settings$db = _ref6.settings.db;\n\t        var uri = _ref6$settings$db.uri;\n\t        var credentials = _ref6$settings$db.credentials;\n\t        return regeneratorRuntime.wrap(function _callee4$(_context4) {\n\t            while (1) {\n\t                switch (_context4.prev = _context4.next) {\n\t                    case 0:\n\t                        if (credentials) initDbUsers.bind(this)({ uri: uri, credentials: credentials });\n\t\n\t                    case 1:\n\t                    case 'end':\n\t                        return _context4.stop();\n\t                }\n\t            }\n\t        }, _callee4, this);\n\t    }));\n\t\n\t    function configure(_x4) {\n\t        return ref.apply(this, arguments);\n\t    }\n\t\n\t    return configure;\n\t}();\n\n/***/ },\n/* 2 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t   value: true\n\t});\n\texports.default = db;\n\t\n\tvar _pouchdb = __webpack_require__(14);\n\t\n\tvar _pouchdb2 = _interopRequireDefault(_pouchdb);\n\t\n\tvar _pouchdbAuthentication = __webpack_require__(15);\n\t\n\tvar _pouchdbAuthentication2 = _interopRequireDefault(_pouchdbAuthentication);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\t_pouchdb2.default.plugin(_pouchdbAuthentication2.default);\n\t\n\tfunction fullUri(_ref) {\n\t   var name = _ref.name;\n\t   var uri = _ref.uri;\n\t\n\t   return uri + '/' + name;\n\t}\n\t\n\tfunction db(settings) {\n\t   return new _pouchdb2.default(fullUri(settings), { skipSetup: true });\n\t}\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\texports.defaultDataFlows = undefined;\n\t\n\tvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\t\n\texports.requireAuthWithPersister = requireAuthWithPersister;\n\texports.requireAuthFromRoute = requireAuthFromRoute;\n\texports.provideAuthFromRoute = provideAuthFromRoute;\n\texports.authenticateRoutes = authenticateRoutes;\n\texports.provideInjectionForDomainRouteHandlers = provideInjectionForDomainRouteHandlers;\n\texports.requireInjection = requireInjection;\n\t\n\tvar _react = __webpack_require__(16);\n\t\n\tvar _react2 = _interopRequireDefault(_react);\n\t\n\tvar _dataFlows = __webpack_require__(5);\n\t\n\tvar _dataFlows2 = _interopRequireDefault(_dataFlows);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\texports.defaultDataFlows = _dataFlows2.default;\n\tfunction requireAuthWithPersister(_ref) {\n\t    var path = _ref.path;\n\t    var persister = _ref.persister;\n\t\n\t    return function requireAuth(nextState, replace, callback) {\n\t        var redirect = function redirect(_) {\n\t            replace({ nextPathname: nextState.location.pathname }, path);\n\t            callback();\n\t        };\n\t        (persister || this.db).getSession(function (err, response) {\n\t            if (err) {\n\t                console.log(err);\n\t                redirect();\n\t            } else if (!response.userCtx.name) {\n\t                redirect();\n\t            } else {\n\t                callback();\n\t            }\n\t        });\n\t    };\n\t}\n\t\n\tfunction requireAuthFromRoute(path) {\n\t    return {\n\t        requiresAuthentication: true,\n\t        path: path\n\t    };\n\t}\n\t\n\tfunction provideAuthFromRoute(component) {\n\t    var placeholder = function placeholder(_) {\n\t        return _;\n\t    };\n\t    Object.assign(placeholder, {\n\t        providesAuthentication: true,\n\t        component: component\n\t    });\n\t    return placeholder;\n\t}\n\t\n\tfunction authenticateRouteBasedOnOnEnter(_ref2) {\n\t    var route = _ref2.route;\n\t    var persister = _ref2.persister;\n\t\n\t    return route.props.onEnter && route.props.onEnter.requiresAuthentication ? {\n\t        onEnter: requireAuthWithPersister({ path: route.props.onEnter.path, persister: persister })\n\t    } : {};\n\t}\n\t\n\tfunction authenticateFromRouteBasedOnComponent(_ref3) {\n\t    var route = _ref3.route;\n\t    var persister = _ref3.persister;\n\t\n\t    return route.props.component && route.props.component.providesAuthentication ? {\n\t        component: function component(props) {\n\t            return _react2.default.createElement(route.props.component.component, _extends({ auth: persister }, props));\n\t        }\n\t    } : {};\n\t}\n\t\n\tfunction applyToChildren(_ref4) {\n\t    var children = _ref4.children;\n\t    var block = _ref4.block;\n\t\n\t    if (children) {\n\t        return Array.isArray(children) ? children.map(block) : block(children);\n\t    } else {\n\t        return children;\n\t    }\n\t}\n\t\n\tfunction authenticateRoutes(route, persister) {\n\t    persister = persister || this.db;\n\t    return _react2.default.cloneElement(route, _extends({}, authenticateRouteBasedOnOnEnter({ route: route, persister: persister }), authenticateFromRouteBasedOnComponent({ route: route, persister: persister }), {\n\t        key: route.props.path\n\t    }), applyToChildren({\n\t        children: route.props.children,\n\t        block: function block(route) {\n\t            return authenticateRoutes(route, persister);\n\t        }\n\t    }));\n\t}\n\t\n\tfunction provideInjection(dependentFunction, persister) {\n\t    var _this = this;\n\t\n\t    return function () {\n\t        for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n\t            args[_key] = arguments[_key];\n\t        }\n\t\n\t        return dependentFunction.apply(undefined, [persister || _this.db].concat(args));\n\t    };\n\t}\n\t\n\tfunction provideInjectionToHandlers(route, persister) {\n\t    route.handlers = route.handlers.map(function (handler) {\n\t        return handler.requiresPersister ? provideInjection(handler.dependentFunction, persister) : handler;\n\t    });\n\t    return route;\n\t}\n\t\n\tfunction expandPersisterBackedDomain(domain, persister) {\n\t    var routes = domain.get('routes');\n\t    Object.keys(domain.get('routes')).map(function (route) {\n\t        return domain.register('routes', route, provideInjectionToHandlers(routes[route], persister));\n\t    });\n\t    return domain;\n\t}\n\t\n\tfunction provideInjectionForDomainRouteHandlers(domains, persister) {\n\t    persister = persister || this.db;\n\t    return Object.keys(domains).reduce(function (newDomains, k) {\n\t        newDomains[k] = expandPersisterBackedDomain(domains[k], persister);\n\t        return newDomains;\n\t    }, {});\n\t}\n\t\n\tfunction requireInjection(dependentFunction) {\n\t    return {\n\t        requiresPersister: true,\n\t        dependentFunction: dependentFunction\n\t    };\n\t}\n\n/***/ },\n/* 4 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"redux\");\n\n/***/ },\n/* 5 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\t\n\texports.default = {\n\t    INSERT: function INSERT(state, payload) {\n\t        return [payload].concat(_toConsumableArray(state));\n\t    },\n\t    UPDATE: function UPDATE(state, payload) {\n\t        return state.map(function (doc) {\n\t            return doc._id == payload._id ? payload : doc;\n\t        });\n\t    },\n\t    REMOVE: function REMOVE(state, _ref) {\n\t        var _id = _ref._id;\n\t\n\t        return state.filter(function (doc) {\n\t            return doc._id != _id;\n\t        });\n\t    }\n\t};\n\n/***/ },\n/* 6 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _strictduckDomainDrivenFullstack = __webpack_require__(18);\n\t\n\tvar _domainMiddlewareGenerator = __webpack_require__(7);\n\t\n\tvar _domainMiddlewareGenerator2 = _interopRequireDefault(_domainMiddlewareGenerator);\n\t\n\tvar _db = __webpack_require__(2);\n\t\n\tvar _db2 = _interopRequireDefault(_db);\n\t\n\tvar _utils = __webpack_require__(3);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tvar provide = ( true ? __webpack_require__(1) : require('./domainMiddlewareGenerator')).default;\n\tvar putDb =  true ? __webpack_require__(1).ensureRemoteExistence : function (_) {\n\t    return _;\n\t};\n\t\n\texports.default = _strictduckDomainDrivenFullstack.storePersistencePlugin.implement({\n\t    name: 'DomainDrivenPouchPersistencePlugin',\n\t    constructor: function constructor(_ref) {\n\t        var db = _ref.Domains.settings.db;\n\t\n\t        putDb(db);\n\t        return [{\n\t            db: (0, _db2.default)(db),\n\t            middlewareGenerator: _domainMiddlewareGenerator2.default,\n\t            authenticateRoutes: _utils.authenticateRoutes,\n\t            provideAuthFromRoute: _utils.provideAuthFromRoute,\n\t            provideInjectionForDomainRouteHandlers: _utils.provideInjectionForDomainRouteHandlers\n\t        }];\n\t    },\n\t    provider: function provider() {\n\t        return provide.bind(this.db).apply(undefined, arguments);\n\t    }\n\t});\n\n/***/ },\n/* 7 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\texports.default = domainDrivenReduxMiddleware;\n\t\n\tvar _redux = __webpack_require__(4);\n\t\n\tvar _reduxMiddleware = __webpack_require__(9);\n\t\n\tvar _reduxMiddleware2 = _interopRequireDefault(_reduxMiddleware);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction invert(obj) {\n\t    return Object.keys(obj).reduce(function (inversion, key) {\n\t        inversion[obj[key]] = key;\n\t        return inversion;\n\t    }, {});\n\t}\n\t\n\tvar defaultActionMap = { insert: 'insert', update: 'update', remove: 'remove' };\n\tfunction dbActions(_ref) {\n\t    var _ref$domain = _ref.domain;\n\t    var _ref$domain$actions = _ref$domain.actions;\n\t    var actions = _ref$domain$actions === undefined ? {} : _ref$domain$actions;\n\t    var _ref$domain$pouchActi = _ref$domain.pouchActionMap;\n\t    var actionMap = _ref$domain$pouchActi === undefined ? defaultActionMap : _ref$domain$pouchActi;\n\t\n\t    var invertedActionMap = invert(actionMap);\n\t    var acts = Object.keys(actions).filter(function (a) {\n\t        return [actionMap.update, actionMap.insert, actionMap.remove].indexOf(a) >= 0;\n\t    }).reduce(function (dbActs, a) {\n\t        dbActs[invertedActionMap[a]] = function (doc) {\n\t            try {\n\t                return actions[a](doc);\n\t            } catch (e) {\n\t                if (e instanceof TypeError) {\n\t                    return;\n\t                } else {\n\t                    throw e;\n\t                }\n\t            }\n\t        };\n\t        return dbActs;\n\t    }, {});\n\t    return Object.keys(acts).length ? acts : false;\n\t}\n\t\n\tfunction domainDrivenReduxMiddleware(_ref2) {\n\t    var db = _ref2.db;\n\t    var domains = _ref2.domains;\n\t\n\t    return (0, _reduxMiddleware2.default)(Object.values(domains).filter(function (domain) {\n\t        return dbActions({ domain: domain });\n\t    }).map(function (domain) {\n\t        return {\n\t            path: '/' + domain.prefix,\n\t            prefix: '' + (domain.dbPrefix || ''),\n\t            db: db,\n\t            actions: dbActions({ domain: domain })\n\t        };\n\t    }));\n\t}\n\n/***/ },\n/* 8 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.utils = exports.default = undefined;\n\t\n\tvar _utils = __webpack_require__(3);\n\t\n\tObject.keys(_utils).forEach(function (key) {\n\t  if (key === \"default\") return;\n\t  Object.defineProperty(exports, key, {\n\t    enumerable: true,\n\t    get: function get() {\n\t      return _utils[key];\n\t    }\n\t  });\n\t});\n\t\n\tvar _domainDrivenPouchPersistencePlugin = __webpack_require__(6);\n\t\n\tvar _domainDrivenPouchPersistencePlugin2 = _interopRequireDefault(_domainDrivenPouchPersistencePlugin);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\texports.default = _domainDrivenPouchPersistencePlugin2.default;\n\tvar utils = exports.utils =  true ? __webpack_require__(1) : {};\n\n/***/ },\n/* 9 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\t\n\texports.default = reduxMiddleware;\n\t\n\tvar _jsonPath = __webpack_require__(13);\n\t\n\tvar _jsonPath2 = _interopRequireDefault(_jsonPath);\n\t\n\tvar _asyncFunctionQueue = __webpack_require__(10);\n\t\n\tvar _asyncFunctionQueue2 = _interopRequireDefault(_asyncFunctionQueue);\n\t\n\tvar _deepEqual = __webpack_require__(12);\n\t\n\tvar _deepEqual2 = _interopRequireDefault(_deepEqual);\n\t\n\tvar _redux = __webpack_require__(4);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _objectWithoutProperties(obj, keys) { var target = {}; for (var i in obj) { if (keys.indexOf(i) >= 0) continue; if (!Object.prototype.hasOwnProperty.call(obj, i)) continue; target[i] = obj[i]; } return target; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction warn(what) {\n\t    var fn = console.warn || console.log;\n\t    if (fn) {\n\t        fn.call(console, what);\n\t    }\n\t}\n\t\n\tfunction defaultAction(action) {\n\t    return function () {\n\t        throw new Error('no action provided for ' + action);\n\t    };\n\t}\n\t\n\tvar defaultActions = {\n\t    remove: defaultAction('remove'),\n\t    update: defaultAction('update'),\n\t    insert: defaultAction('insert')\n\t};\n\t\n\tfunction _initFromDb(path) {\n\t    if (!path.lifecycleState) {\n\t        path.lifecycleState = 'INITIALIZING';\n\t        return path.db.allDocs(_extends({\n\t            include_docs: true\n\t        }, path.prefix ? {\n\t            startkey: path.prefix,\n\t            endkey: path.prefix + 'ï¿¿'\n\t        } : {})).then(function (result) {\n\t            result.rows.forEach(function (row) {\n\t                return onDbChange(path, row);\n\t            });\n\t            path.lifecycleState = 'INITIALIZED';\n\t            listen(path);\n\t        });\n\t    }\n\t}\n\t\n\tfunction listen(path) {\n\t    var changes = path.db.changes(_extends({\n\t        live: true, since: 'now', include_docs: true\n\t    }, path.prefix ? {\n\t        filter: function filter(_ref) {\n\t            var _id = _ref._id;\n\t            return _id.split('/')[0] == path.prefix;\n\t        }\n\t    } : {}));\n\t    changes.on('change', function (change) {\n\t        return onDbChange(path, change);\n\t    });\n\t}\n\t\n\tfunction processNewStateForPath(path, state) {\n\t    var docsContainer = _jsonPath2.default.resolve(state, path.path);\n\t\n\t    /* istanbul ignore else */\n\t    if (docsContainer && docsContainer.length && path.lifecycleState == 'INITIALIZED') {\n\t        docsContainer.forEach(function (docs) {\n\t            var _differences = differences(path.docs, docs);\n\t\n\t            var updated = _differences.updated;\n\t            var deleted = _differences.deleted;\n\t            var inserted = _differences.inserted;\n\t\n\t            inserted.concat(updated).forEach(function (doc) {\n\t                return path.insert(doc);\n\t            });\n\t            deleted.forEach(function (doc) {\n\t                return path.remove(doc);\n\t            });\n\t        });\n\t    }\n\t}\n\t\n\tvar Path = function () {\n\t    function Path(_ref2) {\n\t        var _ref2$path = _ref2.path;\n\t        var path = _ref2$path === undefined ? '.' : _ref2$path;\n\t        var _ref2$prefix = _ref2.prefix;\n\t        var prefix = _ref2$prefix === undefined ? '' : _ref2$prefix;\n\t        var db = _ref2.db;\n\t        var actions = _ref2.actions;\n\t\n\t        _classCallCheck(this, Path);\n\t\n\t        if (!db) {\n\t            throw new Error('path ' + path.path + ' needs a db');\n\t        }\n\t\n\t        this.queue = (0, _asyncFunctionQueue2.default)(1);\n\t        this.docs = {};\n\t\n\t        this.db = db;\n\t        this.path = path;\n\t        this.prefix = prefix;\n\t        this.actions = Object.assign({}, defaultActions, actions);\n\t    }\n\t\n\t    _createClass(Path, [{\n\t        key: 'insert',\n\t        value: function insert(doc) {\n\t            this.docs[doc._id] = doc;\n\t            var db = this.db;\n\t            this.queue.push(function (cb) {\n\t                db.put(doc, cb);\n\t            });\n\t        }\n\t    }, {\n\t        key: 'remove',\n\t        value: function remove(doc) {\n\t            var _this = this;\n\t\n\t            var db = this.db;\n\t            this.queue.push(function (cb) {\n\t                db.remove(doc, cb);\n\t                delete _this.docs[doc._id];\n\t            });\n\t        }\n\t    }, {\n\t        key: 'wrapActionCreators',\n\t        value: function wrapActionCreators(dispatch) {\n\t            var _this2 = this;\n\t\n\t            this.propagations = Object.keys(this.actions).reduce(function (propagations, act) {\n\t                propagations[act] = function (doc) {\n\t                    var action = _this2.actions[act](doc);\n\t                    if (action) dispatch(action);\n\t                };\n\t                return propagations;\n\t            }, {});\n\t        }\n\t    }, {\n\t        key: 'initFromDb',\n\t        value: function initFromDb() {\n\t            var _this3 = this;\n\t\n\t            _initFromDb(this).catch(function (err) {\n\t                if (err.status == 401) {\n\t                    _this3.lifecycleState = false;\n\t                    _this3.db.once('login', function (_) {\n\t                        return _initFromDb(_this3);\n\t                    });\n\t                } else {\n\t                    throw err;\n\t                }\n\t            });\n\t        }\n\t    }]);\n\t\n\t    return Path;\n\t}();\n\t\n\tfunction differences(oldDocs, newDocs) {\n\t    var inserted = [],\n\t        updated = [],\n\t        deleted = Object.keys(oldDocs).map(function (oldDocId) {\n\t        return oldDocs[oldDocId];\n\t    });\n\t\n\t    newDocs.forEach(function (newDoc) {\n\t        if (!newDoc._id) warn('doc with no id');\n\t\n\t        deleted = deleted.filter(function (doc) {\n\t            return doc._id !== newDoc._id;\n\t        });\n\t\n\t        var oldDoc = oldDocs[newDoc._id];\n\t        if (!oldDoc) {\n\t            inserted.push(newDoc);\n\t        } else if (!(0, _deepEqual2.default)(oldDoc, newDoc)) {\n\t            updated.push(newDoc);\n\t        }\n\t    });\n\t    return { inserted: inserted, updated: updated, deleted: deleted };\n\t}\n\t\n\tfunction onDbChange(path, _ref3) {\n\t    var changeDoc = _ref3.doc;\n\t\n\t    var change = _objectWithoutProperties(_ref3, ['doc']);\n\t\n\t    if (changeDoc._deleted) {\n\t        if (path.docs[changeDoc._id]) {\n\t            delete path.docs[changeDoc._id];\n\t            path.propagations.remove(changeDoc);\n\t        }\n\t    } else {\n\t        var oldDoc = path.docs[changeDoc._id];\n\t        path.docs[changeDoc._id] = changeDoc;\n\t        if (oldDoc) {\n\t            path.propagations.update(changeDoc);\n\t        } else {\n\t            path.propagations.insert(changeDoc);\n\t        }\n\t    }\n\t}\n\t\n\tfunction reduxMiddleware() {\n\t    var paths = arguments.length <= 0 || arguments[0] === undefined ? [] : arguments[0];\n\t\n\t    if (!Array.isArray(paths)) paths = [paths];\n\t\n\t    if (!paths.length) warn('PouchMiddleware: no paths');\n\t\n\t    paths = paths.map(function (options) {\n\t        return new Path(options);\n\t    });\n\t\n\t    return function (_ref4) {\n\t        var dispatch = _ref4.dispatch;\n\t        var getState = _ref4.getState;\n\t\n\t        paths.forEach(function (path) {\n\t            path.wrapActionCreators(dispatch);\n\t            path.initFromDb();\n\t        });\n\t        return function (next) {\n\t            return function (action) {\n\t                var nextAction = next(action);\n\t                paths.forEach(function (path) {\n\t                    return processNewStateForPath(path, getState());\n\t                });\n\t                return nextAction;\n\t            };\n\t        };\n\t    };\n\t}\n\n/***/ },\n/* 10 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"async-function-queue\");\n\n/***/ },\n/* 11 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"child_process\");\n\n/***/ },\n/* 12 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"deep-equal\");\n\n/***/ },\n/* 13 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"json-path\");\n\n/***/ },\n/* 14 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"pouchdb\");\n\n/***/ },\n/* 15 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"pouchdb-authentication\");\n\n/***/ },\n/* 16 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"react\");\n\n/***/ },\n/* 17 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"requisition\");\n\n/***/ },\n/* 18 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"strictduck-domain-driven-fullstack\");\n\n/***/ }\n/******/ ]);\n\n\n/** WEBPACK FOOTER **\n ** node_production.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap e4f8b37fb7c74cf2d9b6\n **/","import req from 'requisition'\nimport initPouchDB  from './db'\nimport { execSync } from 'child_process'\n\nfunction catchAndTrace(message, err){\n    console.log(message, err)\n    console.trace(err)\n}\n\nfunction injectCredentials({uri, protocols=['http', 'https'], admin: {name, password} }){\n    let p = protocols.filter(p => uri.startsWith(`${p}://`))[0] + '://'\n    return uri.replace(p, `${p}${name}:${password}@`)\n}\n\nfunction safeExec(command){\n    try {\n        execSync(command)\n    } catch(err){\n        console.log(`command \"${command}\" failed with with error ${err}`)\n    }\n}\n\nexport function ensureRemoteExistence({uri, name, credentials: {admin} = {}}){\n    if(admin){\n        safeExec(`curl -silent -X PUT -d '${admin.password}' ${uri}/_config/admins/${admin.name}`)\n    }\n    let endpoint = admin ? injectCredentials({uri: `${uri}/${name}`, admin}) : `${uri}/${name}`\n    safeExec(`curl -silent -X PUT ${endpoint}`)\n}\n\nasync function createSuperAdmin({ uri, name, password }){\n    try {\n        let resp = await req // TODO: this doesn't actually throw an error on 401\n            .put(`${uri}/_config/admins/${name}`)\n            .send(`\"${password}\"`)\n        console.log('Server admin created')\n    } catch (err) {\n        if(err.status != 409){\n            catchAndTrace('error creating superadmin', err)\n        } else {\n            console.log('Server admin already exists')\n        }\n    }\n\n    try {\n        let resp = await this.login(name, password)\n        console.log('Server admin logged in')\n        return resp\n    } catch (err) {\n        catchAndTrace('error logging in superadmin', err)\n    }\n}\n\nasync function initUser({name, password}){\n    try {\n        await this.signup(name, password)\n    } catch (err) {\n        if(err.status != 409){\n            catchAndTrace('error creating superadmin', err)\n        } else {\n            console.log(`user ${name} already exists`)\n        }\n    }\n}\n\nasync function initDbUsers({\n    uri, credentials: {admin, users}\n}){\n    try {\n        await createSuperAdmin.bind(this)({ uri, ...admin })\n    } catch (err) {\n        catchAndTrace('error in initDbUsers', err)\n    }\n    users.forEach(initUser.bind(this))\n}\n\nexport default async function configure({\n    settings: { db: {uri, credentials} }\n}){\n    if(credentials)\n        initDbUsers.bind(this)({uri, credentials});\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/configureServer.js\n **/","import PouchDB from 'pouchdb'\nimport PouchDbAuthentication from 'pouchdb-authentication'\n\nPouchDB.plugin(PouchDbAuthentication)\n\nfunction fullUri({name, uri}){\n    return `${uri}/${name}`\n}\n\nexport default function db(settings){\n   return new PouchDB(fullUri(settings), {skipSetup: true})\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/db.js\n **/","import React from 'react'\nexport defaultDataFlows from './dataFlows'\n\nexport function requireAuthWithPersister({path, persister}) {\n    return function requireAuth(nextState, replace, callback) {\n        let redirect = _ => {\n            replace({ nextPathname: nextState.location.pathname }, path)\n            callback()\n        }\n        (persister || this.db).getSession( (err, response) => {\n            if (err) {\n                console.log(err)\n                redirect()\n            } else if (!response.userCtx.name) {\n                redirect()\n            } else {\n                callback()\n            }\n        });\n    }\n}\n\nexport function requireAuthFromRoute(path){\n    return {\n        requiresAuthentication: true,\n        path \n    }\n}\n\nexport function provideAuthFromRoute(component) {\n    var placeholder = _=>_\n    Object.assign(placeholder, {\n        providesAuthentication: true,\n        component\n    })\n    return placeholder\n}\n\nfunction authenticateRouteBasedOnOnEnter({route, persister}){\n    return (route.props.onEnter && route.props.onEnter.requiresAuthentication) ? {\n        onEnter: requireAuthWithPersister({path: route.props.onEnter.path, persister})\n    } : {}\n}\n\nfunction authenticateFromRouteBasedOnComponent({route, persister}) {\n    return (route.props.component && route.props.component.providesAuthentication) ?  {\n        component: (props) => <route.props.component.component auth={persister} {...props}/>\n    } : {}\n}\n\nfunction applyToChildren({children, block}){\n    if(children){\n        return Array.isArray(children) ?\n            children.map(block) :\n            block(children)\n    } else {\n        return children\n    }\n}\n\nexport function authenticateRoutes(route, persister){\n    persister = persister || this.db\n    return React.cloneElement(\n        route,\n        {\n            ...authenticateRouteBasedOnOnEnter({route, persister}),\n            ...authenticateFromRouteBasedOnComponent({route, persister}),\n            key: route.props.path\n        },\n        applyToChildren({\n            children: route.props.children,\n            block: route => authenticateRoutes(route, persister)\n        })\n    )\n}\n\nfunction provideInjection(dependentFunction, persister){\n    return (...args) => dependentFunction(persister || this.db, ...args)\n}\n\nfunction provideInjectionToHandlers(route, persister){\n    route.handlers = route.handlers.map(\n        handler => handler.requiresPersister ?\n           provideInjection(handler.dependentFunction, persister) :\n           handler\n    )\n    return route\n}\n\n\nfunction expandPersisterBackedDomain(domain, persister){\n    let routes = domain.get('routes')\n    Object.keys(domain.get('routes'))\n        .map(route => domain.register('routes', route, provideInjectionToHandlers(routes[route], persister)))\n    return domain\n}\n\nexport function provideInjectionForDomainRouteHandlers(domains, persister){\n    persister = persister || this.db\n    return Object.keys(domains)\n        .reduce((newDomains, k) => {\n            newDomains[k] = expandPersisterBackedDomain(domains[k], persister);\n            return newDomains\n        }, {})\n}\n\nexport function requireInjection(dependentFunction){\n    return {\n        requiresPersister: true,\n        dependentFunction\n    }\n}\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/utils.js\n **/","module.exports = require(\"redux\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"redux\"\n ** module id = 4\n ** module chunks = 0\n **/","export default {\n    INSERT(state, payload){\n        return [payload, ...state]\n    },\n    UPDATE(state, payload){\n        return state.map(doc => doc._id == payload._id ? payload : doc)\n    },\n    REMOVE(state, {_id}){\n        return state.filter(doc => doc._id != _id)\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/dataFlows.js\n **/","import { storePersistencePlugin } from 'strictduck-domain-driven-fullstack'\nimport domainMiddlewareGenerator from './domainMiddlewareGenerator'\nimport init from './db'\nimport { authenticateRoutes, provideAuthFromRoute, provideInjectionForDomainRouteHandlers } from './utils'\n\nconst provide = ($ES.CONTEXT == 'NODE' ? require('./configureServer') : require('./domainMiddlewareGenerator')).default\nconst putDb = ($ES.CONTEXT == 'NODE' ? require('./configureServer').ensureRemoteExistence : _ => _)\n\nexport default storePersistencePlugin.implement({\n    name: 'DomainDrivenPouchPersistencePlugin',\n    constructor({ Domains: { settings: { db } } }){\n        putDb(db)\n        return [{\n            db: init(db),\n            middlewareGenerator: domainMiddlewareGenerator,\n            authenticateRoutes,\n            provideAuthFromRoute,\n            provideInjectionForDomainRouteHandlers\n        }]\n    },\n    provider(...args){\n        return provide.bind(this.db)(...args)\n    }\n})\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/domainDrivenPouchPersistencePlugin.js\n **/","import { bindActionCreators } from 'redux'\nimport reduxMiddleware from './reduxMiddleware'\n\nfunction invert(obj){\n    return Object.keys(obj).reduce(\n        (inversion, key) => {\n            inversion[obj[key]] = key\n            return inversion\n        }\n    ,{})\n}\n\nlet defaultActionMap = {insert: 'insert', update: 'update', remove: 'remove'}\nfunction dbActions({domain: {\n    actions = {},\n    pouchActionMap: actionMap=defaultActionMap\n}}){\n    let invertedActionMap = invert(actionMap) \n    let acts = Object.keys(actions)\n        .filter(a => [actionMap.update, actionMap.insert, actionMap.remove].indexOf(a) >= 0 )\n        .reduce((dbActs, a) => {\n            dbActs[invertedActionMap[a]] = doc => {\n                try {\n                    return actions[a](doc)\n                } catch(e) {\n                    if(e instanceof TypeError){\n                        return\n                    } else {\n                        throw e\n                    }\n                }\n            }\n            return dbActs\n        }, {})\n    return Object.keys(acts).length ? acts : false\n}\n\nexport default function domainDrivenReduxMiddleware({db, domains}){\n    return reduxMiddleware(\n        Object.values(domains)\n            .filter(domain => dbActions({ domain }))\n            .map( domain => ({\n                path: `/${domain.prefix}`,\n                prefix: `${domain.dbPrefix || ''}`,\n                db,\n                actions: dbActions({ domain })\n            }))\n    )\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/domainMiddlewareGenerator.js\n **/","export default from './domainDrivenPouchPersistencePlugin'\n\nexport const utils = ($ES.CONTEXT == 'NODE' ? require('./configureServer') : {})\n\nexport * from './utils'\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/index.js\n **/","import jPath from 'json-path'\nimport Queue from 'async-function-queue'\nimport equal from 'deep-equal'\nimport { bindActionCreators } from 'redux'\n\nfunction warn(what) {\n    var fn = console.warn || console.log;\n    if (fn) {\n        fn.call(console, what);\n    }\n}\n\nfunction defaultAction(action) {\n    return function() {\n        throw new Error('no action provided for ' + action);\n    };\n}\n\nconst defaultActions = {\n    remove: defaultAction('remove'),\n    update: defaultAction('update'),\n    insert: defaultAction('insert')\n}\n\n\nfunction initFromDb(path) {\n    if(!path.lifecycleState){\n        path.lifecycleState = 'INITIALIZING'\n        return path.db.allDocs({\n            include_docs: true,\n            ...(path.prefix ? {\n                startkey: path.prefix,\n                endkey: `${path.prefix}\\uffff`\n            } : {})\n        }).then(result => {\n            result.rows.forEach(row => onDbChange(path, row))\n            path.lifecycleState = 'INITIALIZED'\n            listen(path)\n        })\n    }\n}\n\nfunction listen(path) {\n    var changes = path.db.changes({\n        live: true, since: 'now', include_docs: true,\n        ...(path.prefix ? {\n            filter: ({_id}) => _id.split('/')[0] == path.prefix\n            } : {})\n    });\n    changes.on('change', change => onDbChange(path, change));\n}\n\n\nfunction processNewStateForPath(path, state) {\n    var docsContainer = jPath.resolve(state, path.path);\n\n    /* istanbul ignore else */\n    if (docsContainer && docsContainer.length && path.lifecycleState == 'INITIALIZED' ){\n        docsContainer.forEach(docs => {\n            var {updated, deleted, inserted} = differences(path.docs, docs)\n            inserted.concat(updated).forEach(doc => path.insert(doc))\n            deleted.forEach(doc => path.remove(doc))\n        });\n    }\n}\n\nclass Path {\n  constructor({path = '.', prefix = '', db, actions}) {\n      if (! db) {\n          throw new Error('path ' + path.path + ' needs a db');\n      }\n\n      this.queue = Queue(1)\n      this.docs = {}\n\n      this.db = db\n      this.path = path\n      this.prefix = prefix\n      this.actions = Object.assign({}, defaultActions, actions)\n  }\n\n  insert(doc) {\n      this.docs[doc._id] = doc\n      var db = this.db\n      this.queue.push(cb => {\n          db.put(doc, cb)\n      })\n  }\n\n  remove(doc) {\n      var db = this.db\n      this.queue.push(cb => {\n          db.remove(doc, cb)\n          delete this.docs[doc._id]\n      })\n  }\n\n  wrapActionCreators(dispatch){\n      this.propagations = Object.keys(this.actions).reduce(\n          (propagations, act) => {\n              propagations[act] = doc => {\n                  let action = this.actions[act](doc)\n                  if(action) dispatch(action)\n              }\n              return propagations\n          }, {}\n      )\n  }\n\n  initFromDb(){\n      initFromDb(this).catch(err => {\n          if(err.status == 401){\n              this.lifecycleState = false\n              this.db.once('login', _ => initFromDb(this))\n          } else {\n              throw err\n          }\n      })\n  }\n}\n\nfunction differences(oldDocs, newDocs) {\n    var inserted = [],\n        updated = [],\n        deleted = Object.keys(oldDocs).map(oldDocId => oldDocs[oldDocId]);\n\n    newDocs.forEach(newDoc => {\n        if (! newDoc._id) warn('doc with no id');\n\n        deleted = deleted.filter(doc => doc._id !== newDoc._id);\n\n        var oldDoc = oldDocs[newDoc._id];\n        if (! oldDoc) {\n            inserted.push(newDoc);\n        } else if (!equal(oldDoc, newDoc)) {\n            updated.push(newDoc);\n        }\n    });\n    return {inserted, updated, deleted}\n}\n\nfunction onDbChange(path, {doc: changeDoc, ...change}) {\n    if (changeDoc._deleted) {\n        if (path.docs[changeDoc._id]) {\n            delete path.docs[changeDoc._id];\n            path.propagations.remove(changeDoc);\n        }\n    } else {\n        var oldDoc = path.docs[changeDoc._id];\n        path.docs[changeDoc._id] = changeDoc;\n        if (oldDoc) {\n            path.propagations.update(changeDoc);\n        } else {\n            path.propagations.insert(changeDoc);\n        }\n    }\n}\n\nexport default function reduxMiddleware(paths = []) {\n    if (!Array.isArray(paths)) \n        paths = [paths];\n\n    if (!paths.length)\n        warn('PouchMiddleware: no paths');\n\n    paths = paths.map(options => new Path(options))\n\n\n    return ({dispatch, getState}) => {\n        paths.forEach(path => {\n            path.wrapActionCreators(dispatch)\n            path.initFromDb()\n        })\n        return next => action => {\n            let nextAction = next(action)\n            paths.forEach(path => processNewStateForPath(path, getState()))\n            return nextAction\n        }\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/reduxMiddleware.js\n **/","module.exports = require(\"async-function-queue\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"async-function-queue\"\n ** module id = 10\n ** module chunks = 0\n **/","module.exports = require(\"child_process\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"child_process\"\n ** module id = 11\n ** module chunks = 0\n **/","module.exports = require(\"deep-equal\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"deep-equal\"\n ** module id = 12\n ** module chunks = 0\n **/","module.exports = require(\"json-path\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"json-path\"\n ** module id = 13\n ** module chunks = 0\n **/","module.exports = require(\"pouchdb\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"pouchdb\"\n ** module id = 14\n ** module chunks = 0\n **/","module.exports = require(\"pouchdb-authentication\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"pouchdb-authentication\"\n ** module id = 15\n ** module chunks = 0\n **/","module.exports = require(\"react\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"react\"\n ** module id = 16\n ** module chunks = 0\n **/","module.exports = require(\"requisition\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"requisition\"\n ** module id = 17\n ** module chunks = 0\n **/","module.exports = require(\"strictduck-domain-driven-fullstack\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"strictduck-domain-driven-fullstack\"\n ** module id = 18\n ** module chunks = 0\n **/"],"sourceRoot":""}